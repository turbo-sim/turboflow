<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>turboflow.axial_turbine.flow_model &mdash; turboflow v0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=87e54e7c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=abecb913" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=90b5f367"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            turboflow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model_description.html">Model Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/developer_guidlines.html">Developer guidlines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/nomenclature.html">Nomenclature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/api_reference.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">turboflow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../turboflow.html">turboflow</a></li>
      <li class="breadcrumb-item active">turboflow.axial_turbine.flow_model</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for turboflow.axial_turbine.flow_model</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">CoolProp</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">solve</span>
<span class="kn">from</span> <span class="nn">scipy.optimize._numdiff</span> <span class="kn">import</span> <span class="n">approx_derivative</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">math</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">utilities</span> <span class="k">as</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">loss_model</span> <span class="k">as</span> <span class="n">lm</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">deviation_model</span> <span class="k">as</span> <span class="n">dm</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">choking_model</span> <span class="k">as</span> <span class="n">cm</span>

<span class="c1"># List of valid options</span>
<span class="n">BLOCKAGE_MODELS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;flat_plate_turbulent&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="evaluate_axial_turbine">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.evaluate_axial_turbine">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_axial_turbine</span><span class="p">(</span>
    <span class="n">variables</span><span class="p">,</span>
    <span class="n">boundary_conditions</span><span class="p">,</span>
    <span class="n">geometry</span><span class="p">,</span>
    <span class="n">fluid</span><span class="p">,</span>
    <span class="n">model_options</span><span class="p">,</span>
    <span class="n">reference_values</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the performance of an axial turbine by evaluating a series of cascades.</span>

<span class="sd">    The function iterates through each cascade, accumulating data on both performance and residuals used to evaluate the physicality of the flow.</span>
<span class="sd">    Between each cascade, the space between the cascades is modelled to give the input to the next cascade.</span>

<span class="sd">    The results are organized into a dictionary that includes:</span>

<span class="sd">    - `cascade`: Contains data specific to each cascade in the series, including loss coefficients and critical conditions.</span>
<span class="sd">    - `plane`: Contains data specific to each flow station, including thermodynamic properties and velocity triangles.</span>
<span class="sd">    - `stage`: Contains data specific to each turbine stage, including degree of reaction.</span>
<span class="sd">    - `geometry`: Contains data on the turbine geometry.</span>
<span class="sd">    - `overall`: Summarizes the overall performance of the turbine, including mass flow rate, efficiency and power output.</span>
<span class="sd">    - `reference_values`: Contain supplementary information.</span>
<span class="sd">    - `residuals`: Summarizes the mismatch in the nonlinear system of equations used to model the turbine.</span>

<span class="sd">    .. note::</span>

<span class="sd">        The output of this function can only be regarded as a physically meaningful solution when the equations are fully closed (i.e., all residuals are close to zero).</span>
<span class="sd">        Therefore, this function is intended to be used within a root-finding or optimization algorithm that systematically adjusts the input variables to drive the residuals to zero and close the system of equations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    variables : dict</span>
<span class="sd">        Dictionary containing flow variable for the cascades.</span>
<span class="sd">    boundary_conditions : dict</span>
<span class="sd">        Dictionary containing boundary conditions for the series of cascades.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary containing geometric parameters of the series of cascades.</span>
<span class="sd">    fluid : object</span>
<span class="sd">        A fluid object with methods for thermodynamic property calculations.</span>
<span class="sd">    model_options : dict</span>
<span class="sd">        Dictionary containing various model options.</span>
<span class="sd">    reference_values : dict</span>
<span class="sd">        Dictionary containing reference values for scaling.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    results : dict</span>
<span class="sd">        Dictionary containing the evaluated results, including planes, cascades, stage, overall,</span>
<span class="sd">        and geometry information.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load variables</span>
    <span class="n">number_of_cascades</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;number_of_cascades&quot;</span><span class="p">]</span>
    <span class="n">h0_in</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="p">[</span><span class="s2">&quot;h0_in&quot;</span><span class="p">]</span>
    <span class="n">s_in</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="p">[</span><span class="s2">&quot;s_in&quot;</span><span class="p">]</span>
    <span class="n">alpha_in</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="p">[</span><span class="s2">&quot;alpha_in&quot;</span><span class="p">]</span>
    <span class="n">angular_speed</span> <span class="o">=</span> <span class="n">boundary_conditions</span><span class="p">[</span><span class="s2">&quot;omega&quot;</span><span class="p">]</span>

    <span class="c1"># Load reference_values</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">reference_values</span><span class="p">[</span><span class="s2">&quot;v0&quot;</span><span class="p">]</span>
    <span class="n">s_range</span> <span class="o">=</span> <span class="n">reference_values</span><span class="p">[</span><span class="s2">&quot;s_range&quot;</span><span class="p">]</span>
    <span class="n">s_min</span> <span class="o">=</span> <span class="n">reference_values</span><span class="p">[</span><span class="s2">&quot;s_min&quot;</span><span class="p">]</span>
    <span class="n">angle_range</span> <span class="o">=</span> <span class="n">reference_values</span><span class="p">[</span><span class="s2">&quot;angle_range&quot;</span><span class="p">]</span>
    <span class="n">angle_min</span> <span class="o">=</span> <span class="n">reference_values</span><span class="p">[</span><span class="s2">&quot;angle_min&quot;</span><span class="p">]</span>

    <span class="c1"># Initialize results structure</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;plane&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span>
        <span class="s2">&quot;cascade&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span>
        <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;overall&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">geometry</span><span class="p">,</span>
        <span class="s2">&quot;reference_values&quot;</span><span class="p">:</span> <span class="n">reference_values</span><span class="p">,</span>
        <span class="s2">&quot;boundary_conditions&quot;</span><span class="p">:</span> <span class="n">boundary_conditions</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># initialize residual arrays</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Rename turbine inlet velocity</span>
    <span class="n">v_in</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s2">&quot;v_in&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">v0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_cascades</span><span class="p">):</span>
        <span class="c1"># Update angular speed</span>
        <span class="n">angular_speed_cascade</span> <span class="o">=</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># update geometry for current cascade</span>
        <span class="n">geometry_cascade</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;number_of_cascades&quot;</span><span class="p">,</span> <span class="s2">&quot;number_of_stages&quot;</span><span class="p">,</span> <span class="s2">&quot;interspace_area_ratio&quot;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Rename variables</span>
        <span class="n">cascade</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">w_out</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s2">&quot;w_out&quot;</span> <span class="o">+</span> <span class="n">cascade</span><span class="p">]</span> <span class="o">*</span> <span class="n">v0</span>
        <span class="n">s_out</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s2">&quot;s_out&quot;</span> <span class="o">+</span> <span class="n">cascade</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_range</span> <span class="o">+</span> <span class="n">s_min</span>
        <span class="n">beta_out</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="s2">&quot;beta_out&quot;</span> <span class="o">+</span> <span class="n">cascade</span><span class="p">]</span> <span class="o">*</span> <span class="n">angle_range</span> <span class="o">+</span> <span class="n">angle_min</span>

        <span class="c1"># Evaluate current cascade</span>
        <span class="n">cascade_inlet_input</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;h0&quot;</span><span class="p">:</span> <span class="n">h0_in</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">s_in</span><span class="p">,</span>
            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">alpha_in</span><span class="p">,</span>
            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">v_in</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">cascade_exit_input</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="n">w_out</span><span class="p">,</span>
            <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="n">beta_out</span><span class="p">,</span>
            <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">s_out</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">choking_input</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cascade</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="n">val</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">variables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;crit&quot;</span> <span class="ow">and</span> <span class="n">cascade</span> <span class="ow">in</span> <span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;v_crit_in&quot;</span>
        <span class="p">}</span>

        <span class="n">cascade_residuals</span> <span class="o">=</span> <span class="n">evaluate_cascade</span><span class="p">(</span>
            <span class="n">cascade_inlet_input</span><span class="p">,</span>
            <span class="n">cascade_exit_input</span><span class="p">,</span>
            <span class="n">choking_input</span><span class="p">,</span>
            <span class="n">fluid</span><span class="p">,</span>
            <span class="n">geometry_cascade</span><span class="p">,</span>
            <span class="n">angular_speed_cascade</span><span class="p">,</span>
            <span class="n">results</span><span class="p">,</span>
            <span class="n">model_options</span><span class="p">,</span>
            <span class="n">reference_values</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add cascade residuals to residual array</span>
        <span class="n">cascade_residuals</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_string_to_keys</span><span class="p">(</span><span class="n">cascade_residuals</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">residuals</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cascade_residuals</span><span class="p">)</span>

        <span class="c1"># Calculate input of next cascade</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">number_of_cascades</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="n">h0_in</span><span class="p">,</span>
                <span class="n">s_in</span><span class="p">,</span>
                <span class="n">alpha_in</span><span class="p">,</span>
                <span class="n">v_in</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">evaluate_cascade_interspace</span><span class="p">(</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;h0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;v_m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;v_t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">geometry_cascade</span><span class="p">[</span><span class="s2">&quot;radius_mean_out&quot;</span><span class="p">],</span>
                <span class="n">geometry_cascade</span><span class="p">[</span><span class="s2">&quot;A_out&quot;</span><span class="p">],</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;blockage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_mean_in&quot;</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;A_in&quot;</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">fluid</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Add exit pressure error to residuals</span>
    <span class="n">p_calc</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">p_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_calc</span> <span class="o">-</span> <span class="n">boundary_conditions</span><span class="p">[</span><span class="s2">&quot;p_out&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">boundary_conditions</span><span class="p">[</span><span class="s2">&quot;p0_in&quot;</span><span class="p">]</span>
    <span class="n">residuals</span><span class="p">[</span><span class="s2">&quot;p_out&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_error</span>

    <span class="c1"># Additional calculations</span>
    <span class="n">loss_fractions</span> <span class="o">=</span> <span class="n">compute_efficiency_breakdown</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cascade&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;cascade&quot;</span><span class="p">],</span> <span class="n">loss_fractions</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute stage performance</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">compute_stage_performance</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>

    <span class="c1"># Compute overall perfrormance</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;overall&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">compute_overall_performance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)])</span>

    <span class="c1"># Store all residuals for export</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;residuals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">residuals</span>

    <span class="c1"># Store the input variables</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;independent_variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>

    <span class="c1"># Retain only variables defined per cascade</span>
    <span class="n">geom_cascades</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">geometry</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">ensure_iterable</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">==</span> <span class="n">number_of_cascades</span>
    <span class="p">}</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">geom_cascades</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span></div>



<div class="viewcode-block" id="evaluate_cascade">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.evaluate_cascade">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_cascade</span><span class="p">(</span>
    <span class="n">cascade_inlet_input</span><span class="p">,</span>
    <span class="n">cascade_exit_input</span><span class="p">,</span>
    <span class="n">choking_input</span><span class="p">,</span>
    <span class="n">fluid</span><span class="p">,</span>
    <span class="n">geometry</span><span class="p">,</span>
    <span class="n">angular_speed</span><span class="p">,</span>
    <span class="n">results</span><span class="p">,</span>
    <span class="n">model_options</span><span class="p">,</span>
    <span class="n">reference_values</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the performance of a cascade configuration.</span>

<span class="sd">    This function evaluates the cascade performance by considering inlet, throat, and exit planes.</span>
<span class="sd">    It also determines the condition for choking according to the selected choking model, and evaluates if the cascade is choked or not. The results are stored in a dictionary.</span>
<span class="sd">    The function returns a dictionary of residuals that includes the mass balance error at both the inlet and exit, loss coefficient errors,</span>
<span class="sd">    and the residuals related to the critical state and choking condition.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cascade_inlet_input : dict</span>
<span class="sd">        Input conditions at the cascade inlet.</span>
<span class="sd">    cascade_throat_input : dict</span>
<span class="sd">        Input conditions at the cascade throat.</span>
<span class="sd">    cascade_exit_input : dict</span>
<span class="sd">        Input conditions at the cascade exit.</span>
<span class="sd">    critical_cascade_input : dict</span>
<span class="sd">        Input conditions for critical state evaluation.</span>
<span class="sd">    fluid : object</span>
<span class="sd">        A fluid object with methods for thermodynamic property calculations.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary containing geometric parameters of the cascade.</span>
<span class="sd">    angular_speed : float</span>
<span class="sd">        Angular speed of the cascade.</span>
<span class="sd">    results : dict</span>
<span class="sd">        Dictionary to store the evaluation results.</span>
<span class="sd">    model_options : dict</span>
<span class="sd">        Dictionary containing various model options.</span>
<span class="sd">    reference_values : dict</span>
<span class="sd">        Dictionary containing reference values for normalization.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    residuals : dict</span>
<span class="sd">        A dictionary containing the residuals of the cascade evaluation.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define model options</span>
    <span class="c1"># TODO Add warnings that some settings have been assumed. This is a dangerous silent behavior as it is now</span>
    <span class="c1"># TODO It would make sense to define default values for these options at a higher level, for instance after processing the configuration file</span>
    <span class="c1"># TODO an advantage of the approach above is that it is possible to print a warning that will not be shown for each iteration of the solvers</span>
    <span class="n">loss_model</span> <span class="o">=</span> <span class="n">model_options</span><span class="p">[</span><span class="s2">&quot;loss_model&quot;</span><span class="p">]</span>
    <span class="n">deviation_model</span> <span class="o">=</span> <span class="n">model_options</span><span class="p">[</span><span class="s2">&quot;deviation_model&quot;</span><span class="p">]</span>

    <span class="c1"># Load reference values</span>
    <span class="n">mass_flow_reference</span> <span class="o">=</span> <span class="n">reference_values</span><span class="p">[</span><span class="s2">&quot;mass_flow_ref&quot;</span><span class="p">]</span>

    <span class="c1"># Evaluate inlet plane</span>
    <span class="n">inlet_plane</span> <span class="o">=</span> <span class="n">evaluate_cascade_inlet</span><span class="p">(</span>
        <span class="n">cascade_inlet_input</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">angular_speed</span>
    <span class="p">)</span>

    <span class="c1"># Evaluate exit plane</span>
    <span class="n">cascade_exit_input</span><span class="p">[</span><span class="s2">&quot;rothalpy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;rothalpy&quot;</span><span class="p">]</span>
    <span class="n">exit_plane</span><span class="p">,</span> <span class="n">loss_dict</span> <span class="o">=</span> <span class="n">evaluate_cascade_exit</span><span class="p">(</span>
        <span class="n">cascade_exit_input</span><span class="p">,</span>
        <span class="n">fluid</span><span class="p">,</span>
        <span class="n">geometry</span><span class="p">,</span>
        <span class="n">inlet_plane</span><span class="p">,</span>
        <span class="n">angular_speed</span><span class="p">,</span>
        <span class="n">model_options</span><span class="p">[</span><span class="s2">&quot;blockage_model&quot;</span><span class="p">],</span>
        <span class="n">loss_model</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Evaluate isentropic enthalpy change</span>
    <span class="n">props_is</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">PSmass_INPUTS</span><span class="p">,</span> <span class="n">exit_plane</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">])</span>
    <span class="n">dh_is</span> <span class="o">=</span> <span class="n">exit_plane</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">props_is</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]</span>

    <span class="c1"># Evaluate critical state</span>
    <span class="n">residuals_critical</span><span class="p">,</span> <span class="n">critical_state</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">evaluate_choking</span><span class="p">(</span>
        <span class="n">choking_input</span><span class="p">,</span>
        <span class="n">inlet_plane</span><span class="p">,</span>
        <span class="n">exit_plane</span><span class="p">,</span>
        <span class="n">fluid</span><span class="p">,</span>
        <span class="n">geometry</span><span class="p">,</span>
        <span class="n">angular_speed</span><span class="p">,</span>
        <span class="n">model_options</span><span class="p">,</span>
        <span class="n">reference_values</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create dictionary with equation residuals</span>
    <span class="n">mass_error_exit</span> <span class="o">=</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;mass_flow&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">exit_plane</span><span class="p">[</span><span class="s2">&quot;mass_flow&quot;</span><span class="p">]</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;loss_error_exit&quot;</span><span class="p">:</span> <span class="n">exit_plane</span><span class="p">[</span><span class="s2">&quot;loss_error&quot;</span><span class="p">],</span>
        <span class="s2">&quot;mass_error_exit&quot;</span><span class="p">:</span> <span class="n">mass_error_exit</span> <span class="o">/</span> <span class="n">mass_flow_reference</span><span class="p">,</span>
        <span class="o">**</span><span class="n">residuals_critical</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Return plane data in dataframe</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">]),</span> <span class="n">inlet_plane</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">=</span> <span class="n">inlet_plane</span>
    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">]),</span> <span class="n">exit_plane</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">=</span> <span class="n">exit_plane</span>

    <span class="c1"># Return cascade data in dataframe</span>
    <span class="n">cascade_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">loss_dict</span><span class="p">,</span>
        <span class="o">**</span><span class="n">critical_state</span><span class="p">,</span>
        <span class="s2">&quot;dh_s&quot;</span><span class="p">:</span> <span class="n">dh_is</span><span class="p">,</span>
        <span class="s2">&quot;incidence&quot;</span><span class="p">:</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;leading_edge_angle&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cascade&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;cascade&quot;</span><span class="p">]),</span> <span class="n">cascade_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">=</span> <span class="n">cascade_data</span>

    <span class="k">return</span> <span class="n">residuals</span></div>



<div class="viewcode-block" id="evaluate_cascade_inlet">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.evaluate_cascade_inlet">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_cascade_inlet</span><span class="p">(</span><span class="n">cascade_inlet_input</span><span class="p">,</span> <span class="n">fluid</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">angular_speed</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the inlet plane of a cascade including velocity triangles,</span>
<span class="sd">    thermodynamic properties, and flow characteristics.</span>

<span class="sd">    This function calculates performance data at the inlet of a cascade based on the cascade geometry,</span>
<span class="sd">    fluid, and flow conditions. It computes velocity triangles, static and stagnation properties,</span>
<span class="sd">    Reynolds and Mach numbers, and the mass flow rate at the inlet.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cascade_inlet_input : dict</span>
<span class="sd">        Input parameters specific to the cascade inlet, including stagnation enthalpy (`h0`),</span>
<span class="sd">        entropy (`s`), absolute velocity (`v`), and flow angle (`alpha`).</span>
<span class="sd">    fluid : object</span>
<span class="sd">        A fluid object with methods for thermodynamic property calculations.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Geometric parameters of the cascade such as radius at the mean inlet (`radius_mean_in`),</span>
<span class="sd">        chord length, and inlet area (`A_in`).</span>
<span class="sd">    angular_speed : float</span>
<span class="sd">        Angular speed of the cascade.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary of calculated parameters at the cascade inlet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Load cascade inlet input</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="n">cascade_inlet_input</span><span class="p">[</span><span class="s2">&quot;h0&quot;</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">cascade_inlet_input</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cascade_inlet_input</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">cascade_inlet_input</span><span class="p">[</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span>

    <span class="c1"># Load geometry</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_mean_in&quot;</span><span class="p">]</span>
    <span class="n">chord</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">]</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;A_in&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate velocity triangles</span>
    <span class="n">blade_speed</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">angular_speed</span>
    <span class="n">velocity_triangle</span> <span class="o">=</span> <span class="n">evaluate_velocity_triangle_in</span><span class="p">(</span><span class="n">blade_speed</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">velocity_triangle</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>
    <span class="n">w_m</span> <span class="o">=</span> <span class="n">velocity_triangle</span><span class="p">[</span><span class="s2">&quot;w_m&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate static properties</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">h0</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">static_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate stagnation properties</span>
    <span class="n">stagnation_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h0</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">stagnation_properties</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_string_to_keys</span><span class="p">(</span><span class="n">stagnation_properties</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate relative stagnation properties</span>
    <span class="n">h0_rel</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">relative_stagnation_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h0_rel</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">relative_stagnation_properties</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_string_to_keys</span><span class="p">(</span>
        <span class="n">relative_stagnation_properties</span><span class="p">,</span> <span class="s2">&quot;0_rel&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Calculate mach, reynolds and mass flow rate for cascade inlet</span>
    <span class="n">Ma</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">a</span>
    <span class="n">Ma_rel</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">a</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">chord</span> <span class="o">/</span> <span class="n">mu</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">w_m</span> <span class="o">*</span> <span class="n">area</span>
    <span class="n">rothalpy</span> <span class="o">=</span> <span class="n">h0_rel</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">blade_speed</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Store results in dictionary</span>
    <span class="n">plane</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">velocity_triangle</span><span class="p">,</span>
        <span class="o">**</span><span class="n">static_properties</span><span class="p">,</span>
        <span class="o">**</span><span class="n">stagnation_properties</span><span class="p">,</span>
        <span class="o">**</span><span class="n">relative_stagnation_properties</span><span class="p">,</span>
        <span class="s2">&quot;Ma&quot;</span><span class="p">:</span> <span class="n">Ma</span><span class="p">,</span>
        <span class="s2">&quot;Ma_rel&quot;</span><span class="p">:</span> <span class="n">Ma_rel</span><span class="p">,</span>
        <span class="s2">&quot;Re&quot;</span><span class="p">:</span> <span class="n">Re</span><span class="p">,</span>
        <span class="s2">&quot;mass_flow&quot;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span>
        <span class="s2">&quot;rothalpy&quot;</span><span class="p">:</span> <span class="n">rothalpy</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">plane</span></div>



<div class="viewcode-block" id="evaluate_cascade_exit">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.evaluate_cascade_exit">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_cascade_exit</span><span class="p">(</span>
    <span class="n">cascade_exit_input</span><span class="p">,</span>
    <span class="n">fluid</span><span class="p">,</span>
    <span class="n">geometry</span><span class="p">,</span>
    <span class="n">inlet_plane</span><span class="p">,</span>
    <span class="n">angular_speed</span><span class="p">,</span>
    <span class="n">blockage</span><span class="p">,</span>
    <span class="n">loss_model</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Evaluate the exit plane of a cascade including velocity triangles,</span>
<span class="sd">    thermodynamic properties, flow characteristics and loss coefficients.</span>

<span class="sd">    This function calculates performance data at the exit of a cascade based on the cascade geometry,</span>
<span class="sd">    fluid, and flow conditions. It computes velocity triangles, static and stagnation properties,</span>
<span class="sd">    Reynolds and Mach numbers, the mass flow rate and loss coefficients at the exit.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cascade_exit_input : dict</span>
<span class="sd">        Input parameters specific to the cascade exit, including relative velocity (`w`),</span>
<span class="sd">        relative flow angle (`beta`), entropy (`s`), and rothalpy.</span>
<span class="sd">    fluid : object</span>
<span class="sd">        A fluid object with methods for thermodynamic property calculations.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Geometric parameters of the cascade such as chord length, opening, and area.</span>
<span class="sd">    inlet_plane : dict</span>
<span class="sd">        performance data at the inlet plane of the cascade.</span>
<span class="sd">    angular_speed : float</span>
<span class="sd">        Angular speed of the cascade.</span>
<span class="sd">    blockage : str or float or None</span>
<span class="sd">        The method or value for determining the throat blockage. It can be</span>
<span class="sd">        a string specifying a model name (`flat_plate_turbulent`), a numeric</span>
<span class="sd">        value between 0 and 1 representing the blockage factor directly, or</span>
<span class="sd">        None to use a default calculation method.</span>
<span class="sd">    loss_model : str</span>
<span class="sd">        The loss model used for calculating loss coefficients.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary of calculated parameters at the cascade exit.</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary of loss coefficients as calculated by the loss model.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load cascade exit variables</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">cascade_exit_input</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">cascade_exit_input</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">cascade_exit_input</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">]</span>
    <span class="n">rothalpy</span> <span class="o">=</span> <span class="n">cascade_exit_input</span><span class="p">[</span><span class="s2">&quot;rothalpy&quot;</span><span class="p">]</span>

    <span class="c1"># Load geometry</span>
    <span class="n">chord</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">]</span>
    <span class="n">opening</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;opening&quot;</span><span class="p">]</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;A_out&quot;</span><span class="p">]</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_mean_out&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate velocity triangles</span>
    <span class="n">blade_speed</span> <span class="o">=</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">radius</span>
    <span class="n">velocity_triangle</span> <span class="o">=</span> <span class="n">evaluate_velocity_triangle_out</span><span class="p">(</span><span class="n">blade_speed</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">velocity_triangle</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span>
    <span class="n">w_m</span> <span class="o">=</span> <span class="n">velocity_triangle</span><span class="p">[</span><span class="s2">&quot;w_m&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate static properties</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">rothalpy</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">blade_speed</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">static_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate stagnation properties</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">stagnation_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h0</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">stagnation_properties</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_string_to_keys</span><span class="p">(</span><span class="n">stagnation_properties</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate relative stagnation properties</span>
    <span class="n">h0_rel</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">relative_stagnation_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h0_rel</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">relative_stagnation_properties</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_string_to_keys</span><span class="p">(</span>
        <span class="n">relative_stagnation_properties</span><span class="p">,</span> <span class="s2">&quot;0_rel&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Calculate mach, reynolds and mass flow rate for cascade inlet</span>
    <span class="n">Ma</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">a</span>
    <span class="n">Ma_rel</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">a</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">chord</span> <span class="o">/</span> <span class="n">mu</span>
    <span class="n">rothalpy</span> <span class="o">=</span> <span class="n">h0_rel</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">blade_speed</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Compute mass flow rate</span>
    <span class="n">blockage_factor</span> <span class="o">=</span> <span class="n">compute_blockage_boundary_layer</span><span class="p">(</span><span class="n">blockage</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">opening</span><span class="p">)</span>
    <span class="n">mass_flow</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">w_m</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">blockage_factor</span><span class="p">)</span>

    <span class="c1"># Evaluate loss coefficient</span>
    <span class="n">min_val</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="n">loss_model_input</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">geometry</span><span class="p">,</span>
        <span class="s2">&quot;loss_model&quot;</span><span class="p">:</span> <span class="n">loss_model</span><span class="p">,</span>
        <span class="s2">&quot;flow&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;p0_rel_in&quot;</span><span class="p">:</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;p0_rel&quot;</span><span class="p">],</span>
            <span class="s2">&quot;p0_rel_out&quot;</span><span class="p">:</span> <span class="n">relative_stagnation_properties</span><span class="p">[</span><span class="s2">&quot;p0_rel&quot;</span><span class="p">],</span>
            <span class="s2">&quot;p_in&quot;</span><span class="p">:</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span>
            <span class="s2">&quot;p_out&quot;</span><span class="p">:</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span>
            <span class="s2">&quot;beta_out&quot;</span><span class="p">:</span> <span class="n">beta</span><span class="p">,</span>
            <span class="s2">&quot;beta_in&quot;</span><span class="p">:</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Ma_rel_in&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;Ma_rel&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;Ma_rel_out&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">Ma_rel</span><span class="p">),</span>
            <span class="s2">&quot;Re_in&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;Re&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;Re_out&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">Re</span><span class="p">),</span>
            <span class="s2">&quot;gamma_out&quot;</span><span class="p">:</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="c1"># Compute loss coefficient from loss model</span>
    <span class="n">loss_dict</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">evaluate_loss_model</span><span class="p">(</span><span class="n">loss_model</span><span class="p">,</span> <span class="n">loss_model_input</span><span class="p">)</span>

    <span class="c1"># Store results in dictionary</span>
    <span class="n">plane</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">velocity_triangle</span><span class="p">,</span>
        <span class="o">**</span><span class="n">static_properties</span><span class="p">,</span>
        <span class="o">**</span><span class="n">stagnation_properties</span><span class="p">,</span>
        <span class="o">**</span><span class="n">relative_stagnation_properties</span><span class="p">,</span>
        <span class="o">**</span><span class="n">loss_dict</span><span class="p">,</span>
        <span class="s2">&quot;Ma&quot;</span><span class="p">:</span> <span class="n">Ma</span><span class="p">,</span>
        <span class="s2">&quot;Ma_rel&quot;</span><span class="p">:</span> <span class="n">Ma_rel</span><span class="p">,</span>
        <span class="s2">&quot;Re&quot;</span><span class="p">:</span> <span class="n">Re</span><span class="p">,</span>
        <span class="s2">&quot;mass_flow&quot;</span><span class="p">:</span> <span class="n">mass_flow</span><span class="p">,</span>
        <span class="s2">&quot;rothalpy&quot;</span><span class="p">:</span> <span class="n">rothalpy</span><span class="p">,</span>
        <span class="s2">&quot;blockage&quot;</span><span class="p">:</span> <span class="n">blockage_factor</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">plane</span><span class="p">,</span> <span class="n">loss_dict</span></div>



<div class="viewcode-block" id="evaluate_cascade_throat">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.evaluate_cascade_throat">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_cascade_throat</span><span class="p">(</span>
    <span class="n">cascade_throat_input</span><span class="p">,</span>
    <span class="n">fluid</span><span class="p">,</span>
    <span class="n">geometry</span><span class="p">,</span>
    <span class="n">inlet_plane</span><span class="p">,</span>
    <span class="n">angular_speed</span><span class="p">,</span>
    <span class="n">blockage</span><span class="p">,</span>
    <span class="n">loss_model</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the throat plane of a cascade including velocity triangles,</span>
<span class="sd">    thermodynamic properties, flow characteristics and loss coefficients.</span>

<span class="sd">    This function calculates performance data at the throat of a cascade based on the cascade geometry,</span>
<span class="sd">    fluid, and flow conditions. It computes velocity triangles, static and stagnation properties,</span>
<span class="sd">    Reynolds and Mach numbers, the mass flow rate and loss coefficients at the throat.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cascade_throat_input : dict</span>
<span class="sd">        Input parameters specific to the cascade throat, including relative velocity (`w`),</span>
<span class="sd">        relative flow angle (`beta`), entropy (`s`), and rothalpy.</span>
<span class="sd">    fluid : object</span>
<span class="sd">        A fluid object with methods for thermodynamic property calculations.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Geometric parameters of the cascade such as chord length, opening, and area.</span>
<span class="sd">    inlet_plane : dict</span>
<span class="sd">        performance data at the inlet plane of the cascade.</span>
<span class="sd">    angular_speed : float</span>
<span class="sd">        Angular speed of the cascade.</span>
<span class="sd">    blockage : str or float or None</span>
<span class="sd">        The method or value for determining the throat blockage. It can be</span>
<span class="sd">        a string specifying a model name (`flat_plate_turbulent`), a numeric</span>
<span class="sd">        value between 0 and 1 representing the blockage factor directly, or</span>
<span class="sd">        None to use a default calculation method.</span>
<span class="sd">    loss_model : str</span>
<span class="sd">        The loss model used for calculating loss coefficients.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary of calculated parameters at the cascade throat.</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary of loss coefficients as calculated by the loss model.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load cascade exit variables</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">cascade_throat_input</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">cascade_throat_input</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">cascade_throat_input</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">]</span>
    <span class="n">rothalpy</span> <span class="o">=</span> <span class="n">cascade_throat_input</span><span class="p">[</span><span class="s2">&quot;rothalpy&quot;</span><span class="p">]</span>

    <span class="c1"># Load geometry</span>
    <span class="n">chord</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">]</span>
    <span class="n">opening</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;opening&quot;</span><span class="p">]</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;A_throat&quot;</span><span class="p">]</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_mean_throat&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate velocity triangles</span>
    <span class="n">blade_speed</span> <span class="o">=</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">radius</span>
    <span class="n">velocity_triangle</span> <span class="o">=</span> <span class="n">evaluate_velocity_triangle_out</span><span class="p">(</span><span class="n">blade_speed</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">velocity_triangle</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate static properties</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">rothalpy</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">blade_speed</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">static_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;mu&quot;</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate stagnation properties</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">stagnation_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h0</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">stagnation_properties</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_string_to_keys</span><span class="p">(</span><span class="n">stagnation_properties</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate relative stagnation properties</span>
    <span class="n">h0_rel</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">relative_stagnation_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">HmassSmass_INPUTS</span><span class="p">,</span> <span class="n">h0_rel</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="n">relative_stagnation_properties</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">add_string_to_keys</span><span class="p">(</span>
        <span class="n">relative_stagnation_properties</span><span class="p">,</span> <span class="s2">&quot;0_rel&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Calculate mach, reynolds and mass flow rate for cascade inlet</span>
    <span class="n">Ma</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">a</span>
    <span class="n">Ma_rel</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">a</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">chord</span> <span class="o">/</span> <span class="n">mu</span>
    <span class="n">rothalpy</span> <span class="o">=</span> <span class="n">h0_rel</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">blade_speed</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Compute mass flow rate</span>
    <span class="n">blockage_factor</span> <span class="o">=</span> <span class="n">compute_blockage_boundary_layer</span><span class="p">(</span><span class="n">blockage</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">opening</span><span class="p">)</span>
    <span class="n">mass_flow</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">blockage_factor</span><span class="p">)</span>

    <span class="c1"># Evaluate loss coefficient</span>
    <span class="n">min_val</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="n">loss_model_input</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;geometry&quot;</span><span class="p">:</span> <span class="n">geometry</span><span class="p">,</span>
        <span class="s2">&quot;loss_model&quot;</span><span class="p">:</span> <span class="n">loss_model</span><span class="p">,</span>
        <span class="s2">&quot;flow&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;p0_rel_in&quot;</span><span class="p">:</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;p0_rel&quot;</span><span class="p">],</span>
            <span class="s2">&quot;p0_rel_out&quot;</span><span class="p">:</span> <span class="n">relative_stagnation_properties</span><span class="p">[</span><span class="s2">&quot;p0_rel&quot;</span><span class="p">],</span>
            <span class="s2">&quot;p_in&quot;</span><span class="p">:</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span>
            <span class="s2">&quot;p_out&quot;</span><span class="p">:</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span>
            <span class="s2">&quot;beta_out&quot;</span><span class="p">:</span> <span class="n">beta</span><span class="p">,</span>
            <span class="s2">&quot;beta_in&quot;</span><span class="p">:</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;beta&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Ma_rel_in&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;Ma_rel&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;Ma_rel_out&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">Ma_rel</span><span class="p">),</span>
            <span class="s2">&quot;Re_in&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">inlet_plane</span><span class="p">[</span><span class="s2">&quot;Re&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;Re_out&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">Re</span><span class="p">),</span>
            <span class="s2">&quot;gamma_out&quot;</span><span class="p">:</span> <span class="n">static_properties</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="c1"># Compute loss coefficient from loss model</span>
    <span class="n">loss_dict</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">evaluate_loss_model</span><span class="p">(</span><span class="n">loss_model</span><span class="p">,</span> <span class="n">loss_model_input</span><span class="p">)</span>

    <span class="c1"># Store results in dictionary</span>
    <span class="n">plane</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">**</span><span class="n">velocity_triangle</span><span class="p">,</span>
        <span class="o">**</span><span class="n">static_properties</span><span class="p">,</span>
        <span class="o">**</span><span class="n">stagnation_properties</span><span class="p">,</span>
        <span class="o">**</span><span class="n">relative_stagnation_properties</span><span class="p">,</span>
        <span class="o">**</span><span class="n">loss_dict</span><span class="p">,</span>
        <span class="s2">&quot;Ma&quot;</span><span class="p">:</span> <span class="n">Ma</span><span class="p">,</span>
        <span class="s2">&quot;Ma_rel&quot;</span><span class="p">:</span> <span class="n">Ma_rel</span><span class="p">,</span>
        <span class="s2">&quot;Re&quot;</span><span class="p">:</span> <span class="n">Re</span><span class="p">,</span>
        <span class="s2">&quot;mass_flow&quot;</span><span class="p">:</span> <span class="n">mass_flow</span><span class="p">,</span>
        <span class="s2">&quot;rothalpy&quot;</span><span class="p">:</span> <span class="n">rothalpy</span><span class="p">,</span>
        <span class="s2">&quot;blockage&quot;</span><span class="p">:</span> <span class="n">blockage_factor</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">plane</span><span class="p">,</span> <span class="n">loss_dict</span></div>



<div class="viewcode-block" id="evaluate_cascade_interspace">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.evaluate_cascade_interspace">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_cascade_interspace</span><span class="p">(</span>
    <span class="n">h0_exit</span><span class="p">,</span>
    <span class="n">v_m_exit</span><span class="p">,</span>
    <span class="n">v_t_exit</span><span class="p">,</span>
    <span class="n">rho_exit</span><span class="p">,</span>
    <span class="n">radius_exit</span><span class="p">,</span>
    <span class="n">area_exit</span><span class="p">,</span>
    <span class="n">blockage_exit</span><span class="p">,</span>
    <span class="n">radius_inlet</span><span class="p">,</span>
    <span class="n">area_inlet</span><span class="p">,</span>
    <span class="n">fluid</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the inlet conditions for the next cascade based on the exit conditions of the previous cascade.</span>

<span class="sd">    This function computes the inlet thermodynamic and velocity conditions for the next cascade using the exit conditions</span>
<span class="sd">    from the previous cascade and the flow equations for the interspace between cascades.</span>

<span class="sd">    Assumptions:</span>

<span class="sd">    - Conservation of stagnation enthalpy</span>
<span class="sd">    - Conservation of angular momentum</span>
<span class="sd">    - Negligible change in density</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h0_exit : float</span>
<span class="sd">        Stagnation enthalpy at the exit of the previous cascade.</span>
<span class="sd">    v_m_exit : float</span>
<span class="sd">        Meridional component of velocity at the exit of the previous cascade.</span>
<span class="sd">    v_t_exit : float</span>
<span class="sd">        Tangential component of velocity at the exit of the previous cascade.</span>
<span class="sd">    rho_exit : float</span>
<span class="sd">        Fluid density at the exit of the previous cascade.</span>
<span class="sd">    radius_exit : float</span>
<span class="sd">        Radius at the exit of the previous cascade.</span>
<span class="sd">    area_exit : float</span>
<span class="sd">        Flow area at the exit of the previous cascade.</span>
<span class="sd">    radius_inlet : float</span>
<span class="sd">        Radius at the inlet of the next cascade.</span>
<span class="sd">    area_inlet : float</span>
<span class="sd">        Flow area at the inlet of the next cascade.</span>
<span class="sd">    fluid : object</span>
<span class="sd">        A fluid object with methods for thermodynamic property calculations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Stagnation enthalpy at the inlet of the next cascade.</span>
<span class="sd">    float</span>
<span class="sd">        Entropy at the inlet of the next cascade.</span>
<span class="sd">    float</span>
<span class="sd">        Flow angle at the inlet of the next cascade (in degrees).</span>
<span class="sd">    float</span>
<span class="sd">        Velocity at the inlet of the next cascade.</span>

<span class="sd">    Warnings</span>
<span class="sd">    --------</span>
<span class="sd">    The assumption of constant density leads to a small inconsistency in the thermodynamic state,</span>
<span class="sd">    manifesting as a slight variation in entropy across the interspace. In future versions of the</span>
<span class="sd">    code, it is recommended to evaluate the interspace with a 1D model for the flow in annular ducts</span>
<span class="sd">    to improve accuracy and consistency in the analysis.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Assume no heat transfer</span>
    <span class="n">h0_in</span> <span class="o">=</span> <span class="n">h0_exit</span>

    <span class="c1"># Assume no friction (angular momentum is conserved)</span>
    <span class="n">v_t_in</span> <span class="o">=</span> <span class="n">v_t_exit</span> <span class="o">*</span> <span class="n">radius_exit</span> <span class="o">/</span> <span class="n">radius_inlet</span>

    <span class="c1"># Assume density variation is negligible</span>
    <span class="n">v_m_in</span> <span class="o">=</span> <span class="n">v_m_exit</span> <span class="o">*</span> <span class="n">area_exit</span> <span class="o">/</span> <span class="n">area_inlet</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">blockage_exit</span><span class="p">)</span>

    <span class="c1"># Compute velocity vector</span>
    <span class="n">v_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_t_in</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_m_in</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">alpha_in</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">arctand</span><span class="p">(</span><span class="n">v_t_in</span> <span class="o">/</span> <span class="n">v_m_in</span><span class="p">)</span>

    <span class="c1"># Compute thermodynamic state</span>
    <span class="n">h_in</span> <span class="o">=</span> <span class="n">h0_in</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">v_in</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">rho_in</span> <span class="o">=</span> <span class="n">rho_exit</span>
    <span class="n">stagnation_properties</span> <span class="o">=</span> <span class="n">fluid</span><span class="o">.</span><span class="n">get_props</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">DmassHmass_INPUTS</span><span class="p">,</span> <span class="n">rho_in</span><span class="p">,</span> <span class="n">h_in</span><span class="p">)</span>
    <span class="n">s_in</span> <span class="o">=</span> <span class="n">stagnation_properties</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">h0_in</span><span class="p">,</span> <span class="n">s_in</span><span class="p">,</span> <span class="n">alpha_in</span><span class="p">,</span> <span class="n">v_in</span></div>



<div class="viewcode-block" id="evaluate_velocity_triangle_in">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.evaluate_velocity_triangle_in">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_velocity_triangle_in</span><span class="p">(</span><span class="n">blade_speed</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the velocity triangle at the inlet of the cascade.</span>

<span class="sd">    This function calculates the components of the velocity triangle at the</span>
<span class="sd">    inlet of a cascade, based on the blade speed, absolute velocity, and</span>
<span class="sd">    absolute flow angle. It computes both the absolute and relative velocity</span>
<span class="sd">    components in the meridional and tangential directions, as well as the</span>
<span class="sd">    relative flow angle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    blade_speed : float</span>
<span class="sd">        Blade speed.</span>
<span class="sd">    v : float</span>
<span class="sd">        Absolute velocity.</span>
<span class="sd">    alpha : float</span>
<span class="sd">        Absolute flow angle in radians.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary containing the following properties:</span>

<span class="sd">        - `blade_speed` (float): Blade velocity.</span>
<span class="sd">        - `v` (float): Absolute velocity.</span>
<span class="sd">        - `v_m` (float): Meridional component of absolute velocity.</span>
<span class="sd">        - `v_t` (float): Tangential component of absolute velocity.</span>
<span class="sd">        - `alpha` (float): Absolute flow angle in radians.</span>
<span class="sd">        - `w` (float): Relative velocity magnitude.</span>
<span class="sd">        - `w_m` (float): Meridional component of relative velocity.</span>
<span class="sd">        - `w_t` (float): Tangential component of relative velocity.</span>
<span class="sd">        - `beta` (float): Relative flow angle in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Absolute velocities</span>
    <span class="n">v_t</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sind</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">v_m</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># Relative velocities</span>
    <span class="n">w_t</span> <span class="o">=</span> <span class="n">v_t</span> <span class="o">-</span> <span class="n">blade_speed</span>
    <span class="n">w_m</span> <span class="o">=</span> <span class="n">v_m</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">w_t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">w_m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Relative flow angle</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">arctand</span><span class="p">(</span><span class="n">w_t</span> <span class="o">/</span> <span class="n">w_m</span><span class="p">)</span>

    <span class="c1"># Store in dict</span>
    <span class="n">vel_in</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;blade_speed&quot;</span><span class="p">:</span> <span class="n">blade_speed</span><span class="p">,</span>
        <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span>
        <span class="s2">&quot;v_m&quot;</span><span class="p">:</span> <span class="n">v_m</span><span class="p">,</span>
        <span class="s2">&quot;v_t&quot;</span><span class="p">:</span> <span class="n">v_t</span><span class="p">,</span>
        <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span>
        <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="n">w</span><span class="p">,</span>
        <span class="s2">&quot;w_m&quot;</span><span class="p">:</span> <span class="n">w_m</span><span class="p">,</span>
        <span class="s2">&quot;w_t&quot;</span><span class="p">:</span> <span class="n">w_t</span><span class="p">,</span>
        <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="n">beta</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">vel_in</span></div>



<div class="viewcode-block" id="evaluate_velocity_triangle_out">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.evaluate_velocity_triangle_out">[docs]</a>
<span class="k">def</span> <span class="nf">evaluate_velocity_triangle_out</span><span class="p">(</span><span class="n">blade_speed</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the velocity triangle at the outlet of the cascade.</span>

<span class="sd">    This function calculates the components of the velocity triangle at the</span>
<span class="sd">    outlet of a cascade, based on the blade speed, relative velocity, and</span>
<span class="sd">    relative flow angle. It computes both the absolute and relative velocity</span>
<span class="sd">    components in the meridional and tangential directions, as well as the</span>
<span class="sd">    absolute flow angle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    blade_speed : float</span>
<span class="sd">        Blade speed.</span>
<span class="sd">    w : float</span>
<span class="sd">        Relative velocity.</span>
<span class="sd">    beta : float</span>
<span class="sd">        Relative flow angle in radians.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary containing the following properties:</span>

<span class="sd">        - `blade_speed` (float): Blade velocity.</span>
<span class="sd">        - `v` (float): Absolute velocity.</span>
<span class="sd">        - `v_m` (float): Meridional component of absolute velocity.</span>
<span class="sd">        - `v_t` (float): Tangential component of absolute velocity.</span>
<span class="sd">        - `alpha` (float): Absolute flow angle in radians.</span>
<span class="sd">        - `w` (float): Relative velocity magnitude.</span>
<span class="sd">        - `w_m` (float): Meridional component of relative velocity.</span>
<span class="sd">        - `w_t` (float): Tangential component of relative velocity.</span>
<span class="sd">        - `beta` (float): Relative flow angle in radians.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Relative velocities</span>
    <span class="n">w_t</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sind</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
    <span class="n">w_m</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>

    <span class="c1"># Absolute velocities</span>
    <span class="n">v_t</span> <span class="o">=</span> <span class="n">w_t</span> <span class="o">+</span> <span class="n">blade_speed</span>
    <span class="n">v_m</span> <span class="o">=</span> <span class="n">w_m</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Absolute flow angle</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">arctand</span><span class="p">(</span><span class="n">v_t</span> <span class="o">/</span> <span class="n">v_m</span><span class="p">)</span>

    <span class="c1"># Store in dict</span>
    <span class="n">vel_out</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;blade_speed&quot;</span><span class="p">:</span> <span class="n">blade_speed</span><span class="p">,</span>
        <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span>
        <span class="s2">&quot;v_m&quot;</span><span class="p">:</span> <span class="n">v_m</span><span class="p">,</span>
        <span class="s2">&quot;v_t&quot;</span><span class="p">:</span> <span class="n">v_t</span><span class="p">,</span>
        <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="n">alpha</span><span class="p">,</span>
        <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="n">w</span><span class="p">,</span>
        <span class="s2">&quot;w_m&quot;</span><span class="p">:</span> <span class="n">w_m</span><span class="p">,</span>
        <span class="s2">&quot;w_t&quot;</span><span class="p">:</span> <span class="n">w_t</span><span class="p">,</span>
        <span class="s2">&quot;beta&quot;</span><span class="p">:</span> <span class="n">beta</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">vel_out</span></div>



<div class="viewcode-block" id="compute_blockage_boundary_layer">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.compute_blockage_boundary_layer">[docs]</a>
<span class="k">def</span> <span class="nf">compute_blockage_boundary_layer</span><span class="p">(</span><span class="n">blockage_model</span><span class="p">,</span> <span class="n">Re</span><span class="p">,</span> <span class="n">chord</span><span class="p">,</span> <span class="n">opening</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the blockage factor due to boundary layer displacement thickness.</span>

<span class="sd">    This function computes the blockage factor caused by the boundary layer</span>
<span class="sd">    displacement thickness at a given flow station. The blockage factor affects</span>
<span class="sd">    mass flow rate calculations effectively reducing the flow area.</span>

<span class="sd">    The blockage factor can be determined through various methods, including:</span>

<span class="sd">        1. Calculation based on a correlation for the displacement thickness of turbulent boundary layer over a flat plate with zero pressure gradient.</span>
<span class="sd">        2. Using a numerical value specified directly by the user.</span>

<span class="sd">    The correlation for turbulent boundary layer displacement thickness over a flat plate is given by :cite:`cengel_fluid_2014`:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \delta^* = \frac{0.048}{Re^{1/5}} \times 0.9 \times \text{chord}</span>

<span class="sd">    From this the blockage factor is calculated as</span>

<span class="sd">    .. math::</span>
<span class="sd">        \text{blockage_factor} = 2 \times \frac{\delta^*}{\text{opening}}</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    blockage_model : str or float or None</span>
<span class="sd">        The method or value for determining the blockage factor. It can be</span>
<span class="sd">        a string specifying a model name (`flat_plate_turbulent`), a numeric</span>
<span class="sd">        value between 0 and 1 representing the blockage factor directly, or</span>
<span class="sd">        None to use a default calculation method.</span>
<span class="sd">    Re : float</span>
<span class="sd">        Reynolds number, used if `blockage_model` is `flat_plate_turbulent`.</span>
<span class="sd">    chord : float</span>
<span class="sd">        Chord length, used if `blockage_model` is `flat_plate_turbulent`.</span>
<span class="sd">    opening : float</span>
<span class="sd">        Throat opening, used if `blockage_model` is `flat_plate_turbulent`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The calculated blockage factor, a value between 0 and 1, where 1</span>
<span class="sd">        indicates full blockage and 0 indicates no blockage.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If `blockage_model` is an invalid option, or required parameters</span>
<span class="sd">        for the chosen method are missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">blockage_model</span> <span class="o">==</span> <span class="n">BLOCKAGE_MODELS</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">displacement_thickness</span> <span class="o">=</span> <span class="mf">0.048</span> <span class="o">/</span> <span class="n">Re</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">chord</span>
        <span class="n">blockage_factor</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">displacement_thickness</span> <span class="o">/</span> <span class="n">opening</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blockage_model</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">blockage_model</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">blockage_factor</span> <span class="o">=</span> <span class="n">blockage_model</span>

    <span class="k">elif</span> <span class="n">blockage_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">blockage_factor</span> <span class="o">=</span> <span class="mf">0.00</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid throat blockage option: &#39;</span><span class="si">{</span><span class="n">blockage_model</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
            <span class="s2">&quot;Valid options are &#39;flat_plate_turbulent&#39;, a numeric value between 0 and 1, or None.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">blockage_factor</span></div>



<div class="viewcode-block" id="compute_efficiency_breakdown">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.compute_efficiency_breakdown">[docs]</a>
<span class="k">def</span> <span class="nf">compute_efficiency_breakdown</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the loss of total-to-static efficiency due to each various loss component in cascades.</span>

<span class="sd">    This function calculates the fraction of total-to-static efficiency drop attributed to each loss component</span>
<span class="sd">    in a turbine cascade. A correction factor for the re-heating effect is applied to align the sum of individual</span>
<span class="sd">    cascade losses with the total observed change in enthalpy and ensure consistency with</span>
<span class="sd">    the overall total-to-static efficiency.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    results : dict</span>
<span class="sd">        The data for the cascades, including plane and cascade specific parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        A DataFrame containing efficiency drop fractions for each loss type in each cascade.</span>
<span class="sd">        Columns are named as `efficiency_drop_{loss_type}`, where `loss_type` includes:</span>

<span class="sd">        - `profile`</span>
<span class="sd">        - `incidence`</span>
<span class="sd">        - `secondary`</span>
<span class="sd">        - `clearance`</span>
<span class="sd">        - `trailing`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Load parameters</span>
    <span class="n">h_out_s</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;reference_values&quot;</span><span class="p">][</span><span class="s2">&quot;h_out_s&quot;</span><span class="p">]</span>
    <span class="n">h0_in</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;h0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">h_out</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cascade</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;cascade&quot;</span><span class="p">]</span>
    <span class="n">number_of_cascades</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;number_of_cascades&quot;</span><span class="p">]</span>

    <span class="c1"># Compute a correction factor due to re-heating effect</span>
    <span class="n">dhs_total</span> <span class="o">=</span> <span class="n">h_out</span> <span class="o">-</span> <span class="n">h_out_s</span>
    <span class="n">dhs_sum</span> <span class="o">=</span> <span class="n">cascade</span><span class="p">[</span><span class="s2">&quot;dh_s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">correction</span> <span class="o">=</span> <span class="n">dhs_total</span> <span class="o">/</span> <span class="n">dhs_sum</span>

    <span class="c1"># Initialize DataFrame</span>
    <span class="n">loss_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span> <span class="s2">&quot;incidence&quot;</span><span class="p">,</span> <span class="s2">&quot;secondary&quot;</span><span class="p">,</span> <span class="s2">&quot;clearance&quot;</span><span class="p">,</span> <span class="s2">&quot;trailing&quot;</span><span class="p">]</span>
    <span class="n">breakdown</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;efficiency_drop_</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">loss_types</span><span class="p">])</span>

    <span class="c1"># Loss breakdown in each cascade</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_cascades</span><span class="p">):</span>
        <span class="c1"># Construct column names dynamically based on loss_types</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;loss_</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">loss_types</span><span class="p">]</span>

        <span class="c1"># Retrieve values for each specified column and compute the fractions</span>
        <span class="n">fracs</span> <span class="o">=</span> <span class="n">cascade</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">col_names</span><span class="p">]</span> <span class="o">/</span> <span class="n">cascade</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;loss_total&quot;</span><span class="p">]</span>
        <span class="n">dh_s</span> <span class="o">=</span> <span class="n">cascade</span><span class="p">[</span><span class="s2">&quot;dh_s&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">efficiency_drop</span> <span class="o">=</span> <span class="n">correction</span> <span class="o">*</span> <span class="n">dh_s</span> <span class="o">/</span> <span class="p">(</span><span class="n">h0_in</span> <span class="o">-</span> <span class="n">h_out_s</span><span class="p">)</span>

        <span class="c1"># Append efficiency drop breakdown</span>
        <span class="n">breakdown</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">breakdown</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fracs</span> <span class="o">*</span> <span class="n">efficiency_drop</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="k">return</span> <span class="n">breakdown</span></div>



<div class="viewcode-block" id="compute_stage_performance">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.compute_stage_performance">[docs]</a>
<span class="k">def</span> <span class="nf">compute_stage_performance</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the stage performance metrics of the turbine.</span>

<span class="sd">    This function extracts necessary values from the `results` dictionary, performs calculations to determine</span>
<span class="sd">    stage performance metrics, and returns these in a dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    results : dict</span>
<span class="sd">        A dictionary containing all necessary information, such as geometry and flow characteristics.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary with calculated stage parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Only proceed if there are stages</span>
    <span class="n">number_of_stages</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">][</span><span class="s2">&quot;number_of_stages&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">number_of_stages</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c1"># Calculate the degree of reaction for each stage using list comprehension</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;h&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_stages</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Store all variables in dictionary</span>
    <span class="n">stages</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;reaction&quot;</span><span class="p">:</span> <span class="n">R</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">stages</span></div>



<div class="viewcode-block" id="compute_overall_performance">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.flow_model.html#turboflow.axial_turbine.flow_model.compute_overall_performance">[docs]</a>
<span class="k">def</span> <span class="nf">compute_overall_performance</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the overall performance metrics of the turbine.</span>

<span class="sd">    This function extracts necessary values from the `results` dictionary, performs calculations to determine</span>
<span class="sd">    overall performance metrics, and returns these in a dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    results : dict</span>
<span class="sd">        A dictionary containing all necessary information, such as geometry and flow characteristics.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        An dictionary containing the calculated performance metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">angular_speed</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;boundary_conditions&quot;</span><span class="p">][</span><span class="s2">&quot;omega&quot;</span><span class="p">]</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;reference_values&quot;</span><span class="p">][</span><span class="s2">&quot;v0&quot;</span><span class="p">]</span>
    <span class="n">h_out_s</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;reference_values&quot;</span><span class="p">][</span><span class="s2">&quot;h_out_s&quot;</span><span class="p">]</span>
    <span class="n">d_out_s</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;reference_values&quot;</span><span class="p">][</span><span class="s2">&quot;d_out_s&quot;</span><span class="p">]</span>

    <span class="c1"># Calculation of overall performance</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;p0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;h0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">v_out</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;v&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">u_out</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;blade_speed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mass_flow</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;mass_flow&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">exit_flow_angle</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;plane&quot;</span><span class="p">][</span><span class="s2">&quot;alpha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">PR_tt</span> <span class="o">=</span> <span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">p0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">PR_ts</span> <span class="o">=</span> <span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">h0_in</span> <span class="o">=</span> <span class="n">h0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">h0_out</span> <span class="o">=</span> <span class="n">h0</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">efficiency_tt</span> <span class="o">=</span> <span class="p">(</span><span class="n">h0_in</span> <span class="o">-</span> <span class="n">h0_out</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">h0_in</span> <span class="o">-</span> <span class="n">h_out_s</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">v_out</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">efficiency_ts</span> <span class="o">=</span> <span class="p">(</span><span class="n">h0_in</span> <span class="o">-</span> <span class="n">h0_out</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">h0_in</span> <span class="o">-</span> <span class="n">h_out_s</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">efficiency_ts_drop_kinetic</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">v_out</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">h0_in</span> <span class="o">-</span> <span class="n">h_out_s</span><span class="p">)</span>
    <span class="n">efficiency_ts_drop_losses</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">efficiency_ts</span> <span class="o">-</span> <span class="n">efficiency_ts_drop_kinetic</span>
    <span class="n">power</span> <span class="o">=</span> <span class="n">mass_flow</span> <span class="o">*</span> <span class="p">(</span><span class="n">h0_in</span> <span class="o">-</span> <span class="n">h0_out</span><span class="p">)</span>
    <span class="n">torque</span> <span class="o">=</span> <span class="n">power</span> <span class="o">/</span> <span class="n">angular_speed</span>
    <span class="n">specific_speed</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">angular_speed</span> <span class="o">*</span> <span class="p">(</span><span class="n">mass_flow</span> <span class="o">/</span> <span class="n">d_out_s</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="p">((</span><span class="n">h0_in</span> <span class="o">-</span> <span class="n">h_out_s</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.75</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Store all variables in dictionary</span>
    <span class="n">overall</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;PR_tt&quot;</span><span class="p">:</span> <span class="n">PR_tt</span><span class="p">,</span>
        <span class="s2">&quot;PR_ts&quot;</span><span class="p">:</span> <span class="n">PR_ts</span><span class="p">,</span>
        <span class="s2">&quot;mass_flow_rate&quot;</span><span class="p">:</span> <span class="n">mass_flow</span><span class="p">,</span>
        <span class="s2">&quot;efficiency_tt&quot;</span><span class="p">:</span> <span class="n">efficiency_tt</span><span class="p">,</span>
        <span class="s2">&quot;efficiency_ts&quot;</span><span class="p">:</span> <span class="n">efficiency_ts</span><span class="p">,</span>
        <span class="s2">&quot;efficiency_ts_drop_kinetic&quot;</span><span class="p">:</span> <span class="n">efficiency_ts_drop_kinetic</span><span class="p">,</span>
        <span class="s2">&quot;efficiency_ts_drop_losses&quot;</span><span class="p">:</span> <span class="n">efficiency_ts_drop_losses</span><span class="p">,</span>
        <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="n">power</span><span class="p">,</span>
        <span class="s2">&quot;torque&quot;</span><span class="p">:</span> <span class="n">torque</span><span class="p">,</span>
        <span class="s2">&quot;angular_speed&quot;</span><span class="p">:</span> <span class="n">angular_speed</span><span class="p">,</span>
        <span class="s2">&quot;exit_flow_angle&quot;</span><span class="p">:</span> <span class="n">exit_flow_angle</span><span class="p">,</span>
        <span class="s2">&quot;exit_velocity&quot;</span><span class="p">:</span> <span class="n">v_out</span><span class="p">,</span>
        <span class="s2">&quot;spouting_velocity&quot;</span><span class="p">:</span> <span class="n">v0</span><span class="p">,</span>
        <span class="s2">&quot;last_blade_velocity&quot;</span><span class="p">:</span> <span class="n">u_out</span><span class="p">,</span>
        <span class="s2">&quot;blade_jet_ratio&quot;</span><span class="p">:</span> <span class="n">u_out</span> <span class="o">/</span> <span class="n">v0</span><span class="p">,</span>
        <span class="s2">&quot;h0_in&quot;</span><span class="p">:</span> <span class="n">h0_in</span><span class="p">,</span>
        <span class="s2">&quot;h0_out&quot;</span><span class="p">:</span> <span class="n">h0_out</span><span class="p">,</span>
        <span class="s2">&quot;h_out_s&quot;</span><span class="p">:</span> <span class="n">h_out_s</span><span class="p">,</span>
        <span class="s2">&quot;specific_speed&quot;</span><span class="p">:</span> <span class="n">specific_speed</span><span class="p">,</span>
        <span class="s2">&quot;blade_jet_ratio_hub&quot;</span><span class="p">:</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_hub_out&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">v0</span><span class="p">,</span>
        <span class="s2">&quot;blade_jet_ratio_mean&quot;</span><span class="p">:</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_mean_out&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">v0</span><span class="p">,</span>
        <span class="s2">&quot;blade_jet_ratio_tip&quot;</span><span class="p">:</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_tip_out&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">v0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">overall</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Lasse Borg Anderson and Roberto Agromayor.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>