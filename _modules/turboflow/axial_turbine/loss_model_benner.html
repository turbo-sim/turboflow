<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>turboflow.axial_turbine.loss_model_benner &mdash; turboflow v0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=87e54e7c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=abecb913" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=90b5f367"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            turboflow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model_description.html">Model Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model_validation.html">Model validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/nomenclature.html">Nomenclature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/api_reference.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">turboflow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../turboflow.html">turboflow</a></li>
      <li class="breadcrumb-item active">turboflow.axial_turbine.loss_model_benner</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for turboflow.axial_turbine.loss_model_benner</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">math</span>

<span class="c1"># TODO: Add smoothing to the min/max/abs/piecewise functions</span>

<span class="c1"># TODO: Create test scripts to plot how the different loss model functions behave when smoothing is applied / verify that the behavior is reasonable beyond their intended range</span>
<span class="c1"># TODO: Raise warninings to a log file to be aware when the loss model is outside its range of validity and because of which variables</span>
<span class="c1"># TODO: the log object can be passed as an additional variable to the functions with a default parameter Logger=None</span>
<span class="c1"># TODO: Whenever something is out of range we can do &quot;if Logger: &quot; to check if the logger was actually passed as an input and log an descriptive message</span>

<span class="c1"># TODO: Write detailed docstring in .rst format explaning the equations of the loss model?</span>
<span class="c1"># TODO: This could be prepared in latex and then transformed into .rst with chatGPT</span>

<span class="c1"># TODO: For all functions:</span>
<span class="c1"># TODO: add docstring explaning the equations and the original paper</span>
<span class="c1"># TODO: explain smoothing/blending tricks</span>
<span class="c1"># We can sit together one day and prepare a draft of the explanation of each function with help of chatGPT</span>
<span class="c1"># In this way I also get the chance to understand how the loss model works in detail</span>


<div class="viewcode-block" id="compute_losses">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.compute_losses">[docs]</a>
<span class="k">def</span> <span class="nf">compute_losses</span><span class="p">(</span><span class="n">input_parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Evaluate loss coefficient according to :cite:`benner_influence_1997`, :cite:`benner_empirical_2006-1` and :cite:`benner_empirical_2006`.</span>

<span class="sd">    This model split the total loss coefficient into profile, secondary, trailing edge, tip clearance and incidence losses.</span>
<span class="sd">    The loss coefficient are combined through the following relation:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \mathrm{Y_{tot}} = (\mathrm{Y_{p}} + \mathrm{Y_{te}} + \mathrm{Y_{inc}})(1-Z/H) + \mathrm{Y_{s}} + \mathrm{Y_{cl}}</span>

<span class="sd">    where :math:`Z` is the penetration depth of the passage vortex separation line in spanwise direction, and :math:`H` is the mean blade height. This quantity depend on the displacement thickness of the</span>
<span class="sd">    inlet endwall bounary layer, which is approximated from a reference value:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \frac{\delta}{H} = \frac{\delta}{H}_\mathrm{ref} \frac{\mathrm{Re_{in}}}{3\cdot10^5}^{-1/7}</span>

<span class="sd">    The reference value may be specified by the user.</span>

<span class="sd">    The function calls a function for each loss component:</span>

<span class="sd">        - :math:`\mathrm{Y_{p}}` : `get_profile_loss`</span>
<span class="sd">        - :math:`\mathrm{Y_{te}}` : `get_trailing_edge_loss`</span>
<span class="sd">        - :math:`\mathrm{Y_{s}}` : `get_secondary_loss`</span>
<span class="sd">        - :math:`\mathrm{Y_{cl}}` : `get_tip_clearance_loss`</span>
<span class="sd">        - :math:`\mathrm{Y_{inc}}` : `get_incidence_loss`</span>
<span class="sd">        - :math:`Z/H` : `get_penetration_depth`</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    input_parameters : dict</span>
<span class="sd">        A dictionary containing containing the keys, `flow`, `geometry` and `options`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary with the loss components.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Extract input parameters</span>
    <span class="n">flow_parameters</span> <span class="o">=</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s2">&quot;flow&quot;</span><span class="p">]</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">input_parameters</span><span class="p">[</span><span class="s2">&quot;loss_model&quot;</span><span class="p">]</span>

    <span class="c1"># Assume angle of minimum incidence loss is equal to metal angle</span>
    <span class="c1"># TODO: Digitize Figure 2 from :cite:`moustapha_improved_1990`?</span>
    <span class="n">beta_des</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;leading_edge_angle&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate inlet displacement thickness to height ratio</span>
    <span class="n">delta_height</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;inlet_displacement_thickness_height_ratio&quot;</span><span class="p">]</span>
    <span class="n">delta_height</span> <span class="o">=</span> <span class="n">delta_height</span> <span class="o">*</span> <span class="p">(</span><span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;Re_in&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3e5</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span>

    <span class="c1"># Profile loss coefficient</span>
    <span class="n">Y_p</span> <span class="o">=</span> <span class="n">get_profile_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span>

    <span class="c1"># Trailing edge coefficient</span>
    <span class="n">Y_te</span> <span class="o">=</span> <span class="n">get_trailing_edge_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span>

    <span class="c1"># Secondary loss coefficient</span>
    <span class="n">Y_s</span> <span class="o">=</span> <span class="n">get_secondary_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">delta_height</span><span class="p">)</span>

    <span class="c1"># Tip clearance loss coefficient</span>
    <span class="n">Y_cl</span> <span class="o">=</span> <span class="n">get_tip_clearance_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span>

    <span class="c1"># Incidence loss coefficient</span>
    <span class="n">Y_inc</span> <span class="o">=</span> <span class="n">get_incidence_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">beta_des</span><span class="p">)</span>

    <span class="c1"># Penetration depth to blade height ratio</span>
    <span class="n">ZTE</span> <span class="o">=</span> <span class="n">get_penetration_depth</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">delta_height</span><span class="p">)</span>

    <span class="c1"># Correct profile losses according to penetration depth</span>
    <span class="n">Y_p</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ZTE</span>
    <span class="n">Y_te</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ZTE</span>
    <span class="n">Y_inc</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ZTE</span>

    <span class="c1"># Return a dictionary of loss components</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;loss_profile&quot;</span><span class="p">:</span> <span class="n">Y_p</span><span class="p">,</span>
        <span class="s2">&quot;loss_incidence&quot;</span><span class="p">:</span> <span class="n">Y_inc</span><span class="p">,</span>
        <span class="s2">&quot;loss_trailing&quot;</span><span class="p">:</span> <span class="n">Y_te</span><span class="p">,</span>
        <span class="s2">&quot;loss_secondary&quot;</span><span class="p">:</span> <span class="n">Y_s</span><span class="p">,</span>
        <span class="s2">&quot;loss_clearance&quot;</span><span class="p">:</span> <span class="n">Y_cl</span><span class="p">,</span>
        <span class="s2">&quot;loss_total&quot;</span><span class="p">:</span> <span class="n">Y_p</span> <span class="o">+</span> <span class="n">Y_te</span> <span class="o">+</span> <span class="n">Y_inc</span> <span class="o">+</span> <span class="n">Y_s</span> <span class="o">+</span> <span class="n">Y_cl</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">losses</span></div>



<div class="viewcode-block" id="get_profile_loss">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_profile_loss">[docs]</a>
<span class="k">def</span> <span class="nf">get_profile_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the profile loss coefficient for the current cascade using the Kacker and Okapuu loss model.</span>
<span class="sd">    The equation for :math:`\mathrm{Y_p}` is given by:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \mathrm{Y_p} = \mathrm{Y_{reaction}} - \left|\frac{\theta_\mathrm{in}}{\beta_\mathrm{out}}\right| \cdot</span>
<span class="sd">        \left(\frac{\theta_\mathrm{in}}{\beta_\mathrm{out}}\right) \cdot (\mathrm{Y_{impulse}} - \mathrm{Y_{reaction}})</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`\mathrm{Y_{reaction}}` is the reaction loss coefficient computed using Aungier correlation.</span>
<span class="sd">        - :math:`\mathrm{Y_{impulse}}` is the impulse loss coefficient computed using Aungier correlation.</span>
<span class="sd">        - :math:`\theta_\mathrm{in}` is the inlet metal angle.</span>
<span class="sd">        - :math:`\beta_\mathrm{out}` is the exit flow angle.</span>

<span class="sd">    The function also applies various corrections based on flow parameters and geometry factors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flow_parameters : dict</span>
<span class="sd">        Dictionary containing flow-related parameters.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary with geometric parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Profile loss coefficient.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: explain smoothing/blending tricks</span>

    <span class="c1"># Load data</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;Re_out&quot;</span><span class="p">]</span>
    <span class="n">Ma_rel_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;Ma_rel_out&quot;</span><span class="p">]</span>
    <span class="n">Ma_rel_in</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;Ma_rel_in&quot;</span><span class="p">]</span>
    <span class="n">p0rel_in</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;p0_rel_in&quot;</span><span class="p">]</span>
    <span class="n">p_in</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;p_in&quot;</span><span class="p">]</span>
    <span class="n">p0rel_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;p0_rel_out&quot;</span><span class="p">]</span>
    <span class="n">p_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;p_out&quot;</span><span class="p">]</span>
    <span class="n">beta_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_out&quot;</span><span class="p">]</span>

    <span class="n">r_ht_in</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;hub_tip_ratio_in&quot;</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pitch&quot;</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">]</span>
    <span class="n">theta_in</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;leading_edge_angle&quot;</span><span class="p">]</span>
    <span class="n">t_max</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;maximum_thickness&quot;</span><span class="p">]</span>
    <span class="n">cascade_type</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;cascade_type&quot;</span><span class="p">]</span>

    <span class="c1"># Reynolds number correction factor</span>
    <span class="n">f_Re</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">Re</span> <span class="o">/</span> <span class="mf">2e5</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Re</span> <span class="o">&lt;</span> <span class="mf">2e5</span><span class="p">)</span>
        <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">Re</span> <span class="o">&gt;=</span> <span class="mf">2e5</span> <span class="ow">and</span> <span class="n">Re</span> <span class="o">&lt;=</span> <span class="mf">1e6</span><span class="p">)</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">Re</span> <span class="o">/</span> <span class="mf">1e6</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Re</span> <span class="o">&gt;</span> <span class="mf">1e6</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Mach number correction factor</span>
    <span class="n">f_Ma</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">60</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ma_rel_out</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">Ma_rel_out</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="p">)</span>  <span class="c1">## TODO smoothing / mach crit</span>

    <span class="c1"># Compute losses related to shock effects at the inlet of the cascade</span>
    <span class="n">f_hub</span> <span class="o">=</span> <span class="n">get_hub_to_mean_mach_ratio</span><span class="p">(</span><span class="n">r_ht_in</span><span class="p">,</span> <span class="n">cascade_type</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">f_hub</span> <span class="o">*</span> <span class="n">Ma_rel_in</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">)</span>  <span class="c1"># TODO: smoothing</span>
    <span class="n">Y_shock</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span><span class="mf">1.75</span> <span class="o">*</span> <span class="n">r_ht_in</span> <span class="o">*</span> <span class="p">(</span><span class="n">p0rel_in</span> <span class="o">-</span> <span class="n">p_in</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p0rel_out</span> <span class="o">-</span> <span class="n">p_out</span><span class="p">)</span>
    <span class="n">Y_shock</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Y_shock</span><span class="p">)</span>  <span class="c1"># TODO: smoothing</span>

    <span class="c1"># Compute compressible flow correction factors</span>
    <span class="n">Kp</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K1</span> <span class="o">=</span> <span class="n">get_compressible_correction_factors</span><span class="p">(</span><span class="n">Ma_rel_in</span><span class="p">,</span> <span class="n">Ma_rel_out</span><span class="p">)</span>

    <span class="c1"># Yp_reaction and Yp_impulse according to Aungier correlation</span>
    <span class="c1"># These formulas are valid for 40&lt;abs(angle_out)&lt;80</span>
    <span class="c1"># Extrapolating outside of this limits might give completely wrong results</span>
    <span class="c1"># If the optimization algorithm has upper and lower bounds for the outlet</span>
    <span class="c1"># angle there is no need to worry about this problem</span>
    <span class="c1"># angle_out_bis keeps the 40deg-losses for outlet angles lower than 40deg</span>
    <span class="n">angle_out_bis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">beta_out</span><span class="p">),</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">Yp_reaction</span> <span class="o">=</span> <span class="n">nozzle_blades</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span> <span class="n">angle_out_bis</span><span class="p">)</span>
    <span class="n">Yp_impulse</span> <span class="o">=</span> <span class="n">impulse_blades</span><span class="p">(</span><span class="n">s</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span> <span class="n">angle_out_bis</span><span class="p">)</span>

    <span class="c1"># Formula according to Kacker-Okapuu</span>
    <span class="n">Y_p</span> <span class="o">=</span> <span class="n">Yp_reaction</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta_in</span> <span class="o">/</span> <span class="n">beta_out</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta_in</span> <span class="o">/</span> <span class="n">beta_out</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">Yp_impulse</span> <span class="o">-</span> <span class="n">Yp_reaction</span>
    <span class="p">)</span>

    <span class="c1"># Limit the extrapolation of the profile loss to avoid negative values for</span>
    <span class="c1"># blade profiles with little deflection</span>
    <span class="c1"># Low limit to 80% of the axial entry nozzle profile loss</span>
    <span class="c1"># This value is completely arbitrary</span>
    <span class="n">Y_p</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Y_p</span><span class="p">,</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">Yp_reaction</span><span class="p">)</span>  <span class="c1"># TODO: smoothing</span>

    <span class="c1"># Avoid unphysical effect on the thickness by defining the variable aa</span>
    <span class="n">aa</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">theta_in</span> <span class="o">/</span> <span class="n">beta_out</span><span class="p">)</span>  <span class="c1"># TODO: smoothing</span>
    <span class="n">Y_p</span> <span class="o">=</span> <span class="n">Y_p</span> <span class="o">*</span> <span class="p">((</span><span class="n">t_max</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">**</span> <span class="n">aa</span>
    <span class="n">Y_p</span> <span class="o">=</span> <span class="mf">0.914</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">Y_p</span> <span class="o">*</span> <span class="n">Kp</span> <span class="o">+</span> <span class="n">Y_shock</span><span class="p">)</span>

    <span class="c1"># Corrected profile loss coefficient</span>
    <span class="n">Y_p</span> <span class="o">=</span> <span class="n">f_Re</span> <span class="o">*</span> <span class="n">f_Ma</span> <span class="o">*</span> <span class="n">Y_p</span>

    <span class="k">return</span> <span class="n">Y_p</span></div>



<div class="viewcode-block" id="get_trailing_edge_loss">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_trailing_edge_loss">[docs]</a>
<span class="k">def</span> <span class="nf">get_trailing_edge_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the trailing edge loss coefficient using the Kacker-Okapuu model.</span>
<span class="sd">    The main equation for the kinetic-energy coefficient is given by:</span>

<span class="sd">    .. math::</span>

<span class="sd">        d_{\phi^2} = d_{\phi^2_\mathrm{reaction}} - \left|\frac{\theta_\mathrm{in}}{\beta_\mathrm{out}}\right| \cdot</span>
<span class="sd">        \left(\frac{\theta_\mathrm{in}}{\beta_\mathrm{out}}\right) \cdot (d_{\phi^2_\mathrm{impulse}} - d_{\phi^2_\mathrm{reaction}})</span>

<span class="sd">    The kinetic-energy coefficient is converted to the total pressure loss coefficient by:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \mathrm{Y_{te}} = \frac{1}{{1 - \phi^2}} - 1</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`d_{\phi^2_\mathrm{reaction}}` and :math:`d_{\phi^2_\mathrm{impulse}}` are coefficients related to kinetic energy loss for reaction and impulse blades respectively, and are interpolated based on trailing edge to throat opening ratio.</span>
<span class="sd">        - :math:`\beta_\mathrm{out}` is the exit flow angle.</span>
<span class="sd">        - :math:`\theta_\mathrm{in}` is the inlet metal angle.</span>

<span class="sd">    The function also applies various interpolations and computations based on flow parameters and geometry factors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flow_parameters : dict</span>
<span class="sd">        Dictionary containing flow-related parameters.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary with geometric parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Trailing edge loss coefficient.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">t_te</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;trailing_edge_thickness&quot;</span><span class="p">]</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;opening&quot;</span><span class="p">]</span>
    <span class="n">angle_in</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;leading_edge_angle&quot;</span><span class="p">]</span>
    <span class="n">angle_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_out&quot;</span><span class="p">]</span>

    <span class="c1"># Range of trailing edge to throat opening ratio</span>
    <span class="n">r_to_data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>

    <span class="c1"># Reacting blading</span>
    <span class="n">phi_data_reaction</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.045</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]</span>

    <span class="c1"># Impulse blading</span>
    <span class="n">phi_data_impulse</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">]</span>

    <span class="c1"># Numerical trick to avoid too big r_to&#39;s</span>
    <span class="n">r_to</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">t_te</span> <span class="o">/</span> <span class="n">o</span><span class="p">)</span>  <span class="c1"># TODO: smoothing</span>

    <span class="c1"># Interpolate data</span>
    <span class="n">d_phi2_reaction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">r_to</span><span class="p">,</span> <span class="n">r_to_data</span><span class="p">,</span> <span class="n">phi_data_reaction</span><span class="p">)</span>
    <span class="n">d_phi2_impulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">r_to</span><span class="p">,</span> <span class="n">r_to_data</span><span class="p">,</span> <span class="n">phi_data_impulse</span><span class="p">)</span>

    <span class="c1"># Compute kinetic energy loss coefficient</span>
    <span class="n">d_phi2</span> <span class="o">=</span> <span class="n">d_phi2_reaction</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">angle_in</span> <span class="o">/</span> <span class="n">angle_out</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">angle_in</span> <span class="o">/</span> <span class="n">angle_out</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">d_phi2_impulse</span> <span class="o">-</span> <span class="n">d_phi2_reaction</span>
    <span class="p">)</span>

    <span class="c1"># Limit the extrapolation of the trailing edge loss</span>
    <span class="n">d_phi2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d_phi2</span><span class="p">,</span> <span class="n">d_phi2_impulse</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># TODO: smoothing</span>
    <span class="n">Y_te</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d_phi2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">Y_te</span></div>



<div class="viewcode-block" id="get_secondary_loss">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_secondary_loss">[docs]</a>
<span class="k">def</span> <span class="nf">get_secondary_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">delta_height</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the secondary loss coefficient.</span>

<span class="sd">    The correlation takes two different forms depending on the aspect ratio:</span>

<span class="sd">    If aspect ratio :math:`\leq 2.0`</span>

<span class="sd">    .. math::</span>

<span class="sd">        \mathrm{Y_{s}} = \frac{0.038 + 0.41 \tanh(1.20\delta^*/H)}{\sqrt{\cos(\xi)}CR(H/c)^{0.55}\frac{\cos(\beta_\mathrm{out})}{\cos(\xi)}^{0.55}}</span>

<span class="sd">    wheras if aspect ratio :math:`&gt;2.0`</span>

<span class="sd">    .. math::</span>

<span class="sd">        \mathrm{Y_{s}} = \frac{0.052 + 0.56 \tanh(1.20\delta^*/H)}{\sqrt{\cos(\xi)}CR(H/c)\frac{\cos(\beta_\mathrm{out})}{\cos(\xi)}^{0.55}}</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`CR = \frac{\cos(\beta_\mathrm{in})}{\cos(\beta_\mathrm{out})}` is the convergence ratio.</span>
<span class="sd">        - :math:`H` is the mean height.</span>
<span class="sd">        - :math:`c` is the chord.</span>
<span class="sd">        - :math:`\delta^*` is the inlet endwall boundary layer displacement thickness.</span>
<span class="sd">        - :math:`\xi` is the stagger angle.</span>
<span class="sd">        - :math:`\beta_\mathrm{out}` is the exit relative flow angle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flow_parameters : dict</span>
<span class="sd">        Dictionary containing flow-related parameters.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary with geometric parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Secondary loss coefficient.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">beta_in</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_in&quot;</span><span class="p">]</span>
    <span class="n">beta_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_out&quot;</span><span class="p">]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="n">chord</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">]</span>
    <span class="n">stagger</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;stagger_angle&quot;</span><span class="p">]</span>

    <span class="n">AR</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">chord</span>
    <span class="n">CR</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta_in</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta_out</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">AR</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># TODO: sigmoid blending to convert to smooth piecewise function</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">stagger</span><span class="p">))</span>
            <span class="o">*</span> <span class="n">CR</span>
            <span class="o">*</span> <span class="n">AR</span><span class="o">**</span><span class="mf">0.55</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta_out</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">stagger</span><span class="p">)))</span> <span class="o">**</span> <span class="mf">0.55</span>
        <span class="p">)</span>
        <span class="n">Y_sec</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.038</span> <span class="o">+</span> <span class="mf">0.41</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">delta_height</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">stagger</span><span class="p">))</span>
            <span class="o">*</span> <span class="n">CR</span>
            <span class="o">*</span> <span class="n">AR</span>
            <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta_out</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">stagger</span><span class="p">)))</span> <span class="o">**</span> <span class="mf">0.55</span>
        <span class="p">)</span>
        <span class="n">Y_sec</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.052</span> <span class="o">+</span> <span class="mf">0.56</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="mf">1.2</span> <span class="o">*</span> <span class="n">delta_height</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span>

    <span class="k">return</span> <span class="n">Y_sec</span></div>



<div class="viewcode-block" id="get_tip_clearance_loss">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_tip_clearance_loss">[docs]</a>
<span class="k">def</span> <span class="nf">get_tip_clearance_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the tip clearance loss coefficient for the current cascade using the Kacker and Okapuu loss model.</span>
<span class="sd">    The equation for the tip clearance loss coefficent is given by:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \mathrm{Y_{cl}} = B \cdot Z \cdot \frac{c}{H} \cdot \left(\frac{t_\mathrm{cl}}{H}\right)^{0.78}</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`B` is an empirical parameter that depends on the type of cascade (0 for stator, 0.37 for shrouded rotor).</span>
<span class="sd">        - :math:`Z` is a blade loading parameter</span>
<span class="sd">        - :math:`c` is the chord.</span>
<span class="sd">        - :math:`H` is the mean blade height.</span>
<span class="sd">        - :math:`t_\mathrm{cl}` is the tip clearance.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flow_parameters : dict</span>
<span class="sd">        Dictionary containing flow-related parameters.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary with geometric parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Tip clearance loss coefficient.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">beta_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_out&quot;</span><span class="p">]</span>
    <span class="n">beta_in</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_in&quot;</span><span class="p">]</span>

    <span class="n">H</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">]</span>
    <span class="n">t_cl</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;tip_clearance&quot;</span><span class="p">]</span>
    <span class="n">cascade_type</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;cascade_type&quot;</span><span class="p">]</span>

    <span class="c1"># Calculate blade loading parameter Z</span>
    <span class="n">angle_m</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">arctand</span><span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">beta_in</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">beta_out</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">4</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">beta_in</span><span class="p">)</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">beta_out</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta_out</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">angle_m</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Empirical parameter (0 for stator, 0.37 for shrouded rotor)</span>
    <span class="k">if</span> <span class="n">cascade_type</span> <span class="o">==</span> <span class="s2">&quot;stator&quot;</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">cascade_type</span> <span class="o">==</span> <span class="s2">&quot;rotor&quot;</span><span class="p">:</span>
        <span class="n">B</span> <span class="o">=</span> <span class="mf">0.37</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Specify the type of cascade&quot;</span><span class="p">)</span>

    <span class="c1"># Tip clearance loss coefficient</span>
    <span class="n">Y_cl</span> <span class="o">=</span> <span class="n">B</span> <span class="o">*</span> <span class="n">Z</span> <span class="o">*</span> <span class="n">c</span> <span class="o">/</span> <span class="n">H</span> <span class="o">*</span> <span class="p">(</span><span class="n">t_cl</span> <span class="o">/</span> <span class="n">H</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.78</span>

    <span class="k">return</span> <span class="n">Y_cl</span></div>



<div class="viewcode-block" id="get_incidence_loss">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_incidence_loss">[docs]</a>
<span class="k">def</span> <span class="nf">get_incidence_loss</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">beta_des</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the incidence loss coefficient according to the correlation proposed by :cite:`benner_influence_1997`.</span>

<span class="sd">    This model calculates the incidence loss parameter through the function `get_incidence_parameter`. The kinetic energu coefficient</span>
<span class="sd">    can be obtained from `get_incidence_profile_loss_increment`, which is a function of the incidence parameter. The kinetic energy loss coefficient is converted</span>
<span class="sd">    to the total pressure loss coefficient through `convert_kinetic_energy_coefficient`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flow_parameters : dict</span>
<span class="sd">        Dictionary containing flow-related parameters.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary with geometric parameters.</span>
<span class="sd">    beta_des : float</span>
<span class="sd">        Inlet flow angle for zero incidence losses (design).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Incidence loss coefficient.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">beta_in</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_in&quot;</span><span class="p">]</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;gamma_out&quot;</span><span class="p">]</span>
    <span class="n">Ma_rel_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;Ma_rel_out&quot;</span><span class="p">]</span>

    <span class="n">le</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;leading_edge_diameter&quot;</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pitch&quot;</span><span class="p">]</span>
    <span class="n">We</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;leading_edge_wedge_angle&quot;</span><span class="p">]</span>
    <span class="n">theta_in</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;leading_edge_angle&quot;</span><span class="p">]</span>
    <span class="n">theta_out</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">arccosd</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;A_throat&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;A_out&quot;</span><span class="p">])</span>

    <span class="n">chi</span> <span class="o">=</span> <span class="n">get_incidence_parameter</span><span class="p">(</span><span class="n">le</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">We</span><span class="p">,</span> <span class="n">theta_in</span><span class="p">,</span> <span class="n">theta_out</span><span class="p">,</span> <span class="n">beta_in</span><span class="p">,</span> <span class="n">beta_des</span><span class="p">)</span>

    <span class="n">dPhip</span> <span class="o">=</span> <span class="n">get_incidence_profile_loss_increment</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>

    <span class="n">Y_inc</span> <span class="o">=</span> <span class="n">convert_kinetic_energy_coefficient</span><span class="p">(</span><span class="n">dPhip</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">Ma_rel_out</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Y_inc</span></div>



<div class="viewcode-block" id="get_hub_to_mean_mach_ratio">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_hub_to_mean_mach_ratio">[docs]</a>
<span class="k">def</span> <span class="nf">get_hub_to_mean_mach_ratio</span><span class="p">(</span><span class="n">r_ht</span><span class="p">,</span> <span class="n">cascade_type</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the ratio between Mach at the hub and mean span at the inlet of the current cascade.</span>

<span class="sd">    Due to radial variation in gas conditions, Mach at the hub will always be higher than at the mean.</span>
<span class="sd">    Thus, shock losses at the hub could occur even when the Mach is subsonic at the mean blade span.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r_ht : float</span>
<span class="sd">        Hub to tip ratio at the inlet of the current cascade.</span>
<span class="sd">    cascade_type : str</span>
<span class="sd">        Type of the current cascade, either &#39;stator&#39; or &#39;rotor&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Ratio between Mach at the hub and mean span at the inlet of the current cascade.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">r_ht</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># TODO: add smoothing, this is essentially a max(r_ht, 0.5)</span>
        <span class="n">r_ht</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Numerical trick to prevent extrapolation</span>

    <span class="n">r_ht_data</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>

    <span class="c1"># Stator curve</span>
    <span class="n">f_data_S</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.18</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>

    <span class="c1"># Rotor curve</span>
    <span class="n">f_data_R</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.15</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">,</span> <span class="mf">1.12</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">cascade_type</span> <span class="o">==</span> <span class="s2">&quot;stator&quot;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">r_ht</span><span class="p">,</span> <span class="n">r_ht_data</span><span class="p">,</span> <span class="n">f_data_S</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cascade_type</span> <span class="o">==</span> <span class="s2">&quot;rotor&quot;</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">r_ht</span><span class="p">,</span> <span class="n">r_ht_data</span><span class="p">,</span> <span class="n">f_data_R</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Specify the type of cascade&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f</span></div>



<div class="viewcode-block" id="get_compressible_correction_factors">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_compressible_correction_factors">[docs]</a>
<span class="k">def</span> <span class="nf">get_compressible_correction_factors</span><span class="p">(</span><span class="n">Ma_rel_in</span><span class="p">,</span> <span class="n">Ma_rel_out</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Compute compressible flow correction factor according to Kacker and Okapuu loss model :cite:`kacker_mean_1982`.</span>

<span class="sd">    The correction factors :math:`\mathrm{K_1}`, :math:`\mathrm{K_2}` and :math:`\mathrm{K_p}` was introduced by :cite:`kacker_mean_1982` to correct previous correlation (:cite:`ainley_method_1951`)</span>
<span class="sd">    for effect of higher mach number and channel acceleration. The correction factors reduces the losses at higher mach number. Their definition follows: </span>

<span class="sd">    .. math::</span>

<span class="sd">        &amp;\mathrm{K_1} = \begin{cases}</span>
<span class="sd">                1 &amp; \text{if } \mathrm{Ma_{out}} &lt; 0.2 \\</span>
<span class="sd">                1 - 1.25(\mathrm{Ma_{out}} - 0.2) &amp; \text{if } \mathrm{Ma_{out}} \geq 0.2</span>
<span class="sd">              \end{cases} \\</span>
<span class="sd">        &amp;\mathrm{K_2} = \left(\frac{\mathrm{Ma_{in}}}{\mathrm{Ma_{out}}}\right) \\</span>
<span class="sd">        &amp;\mathrm{K_p} = 1 - \mathrm{K_2}(1-\mathrm{K_1})</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`\mathrm{Ma_{in}}` is the relative mach number at the cascade inlet.</span>
<span class="sd">        -  :math:`\mathrm{Ma_{out}}` is the relative mach number at the cascade exit.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Ma_rel_in : float</span>
<span class="sd">        Inlet relative mach number.</span>
<span class="sd">    Ma_rel_out : float</span>
<span class="sd">        Exit relative mach number.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Correction factor :math:`\mathrm{K_p}`.</span>
<span class="sd">    float</span>
<span class="sd">        Correction factor :math:`\mathrm{K_2}`.</span>
<span class="sd">    float</span>
<span class="sd">        Correction factor :math:`\mathrm{K_1}`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">K1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ma_rel_out</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mf">1.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ma_rel_out</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">Ma_rel_out</span> <span class="o">&gt;</span> <span class="mf">0.2</span> <span class="ow">and</span> <span class="n">Ma_rel_out</span> <span class="o">&lt;</span> <span class="mf">1.00</span>
    <span class="p">)</span>  <span class="c1"># TODO: this can be converted to a smooth piecewise function (sigmoid blending)</span>
    <span class="n">K2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ma_rel_in</span> <span class="o">/</span> <span class="n">Ma_rel_out</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">Kp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">K2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">K1</span><span class="p">)</span>
    <span class="n">Kp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">Kp</span><span class="p">)</span>  <span class="c1"># TODO: smoothing</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">Kp</span><span class="p">,</span> <span class="n">K2</span><span class="p">,</span> <span class="n">K1</span><span class="p">]</span></div>



<div class="viewcode-block" id="nozzle_blades">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.nozzle_blades">[docs]</a>
<span class="k">def</span> <span class="nf">nozzle_blades</span><span class="p">(</span><span class="n">r_sc</span><span class="p">,</span> <span class="n">angle_out</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use Aungier correlation to compute the pressure loss coefficient for nozzle blades :cite:`aungier_turbine_2006`.</span>

<span class="sd">    This correlation is a formula that reproduces the figures from the Ainley and Mathieson original figures :cite:`ainley_method_1951`,</span>
<span class="sd">    and is a function of the pitch-to-chord ratio and exit relative flow angle. </span>

<span class="sd">    The correlation uses the following equations:</span>

<span class="sd">    .. math::</span>

<span class="sd">        &amp; \beta_\mathrm{tan} = 90 - \beta_\mathrm{ax} \\</span>
<span class="sd">        &amp; \left(\frac{s}{c}\right)_\mathrm{min} = \begin{cases}</span>
<span class="sd">                                                    0.46 + \frac{\beta_\mathrm{tan}}{77} &amp;&amp; \text{if } \beta_\mathrm{tan} &lt; 30 \\</span>
<span class="sd">                                                    0.614 + \frac{\beta_\mathrm{tan}}{130} &amp;&amp; \text{if } \beta_\mathrm{tan} \geq 30</span>
<span class="sd">                                                \end{cases} \\</span>
<span class="sd">        &amp; X = \left(\frac{s}{c}\right) - \left(\frac{s}{c}\right)_\mathrm{min} \\</span>
<span class="sd">        &amp; A = \begin{cases}</span>
<span class="sd">                0.025 + \frac{27 - \beta_\mathrm{tan}}{530} &amp;&amp; \text{if } \beta_\mathrm{tan} &lt; 27 \\</span>
<span class="sd">                0.025 + \frac{27 - \beta_\mathrm{tan}}{3085} &amp;&amp; \text{if } \beta_\mathrm{tan} \geq 27</span>
<span class="sd">              \end{cases} \\</span>
<span class="sd">        &amp; B = 0.1583 - \frac{\beta_\mathrm{tan}}{1640} \\</span>
<span class="sd">        &amp; C = 0.08\left(\frac{\beta_\mathrm{tan}}{30}\right)^2 -1 \\</span>
<span class="sd">        &amp; n = 1 + \frac{\beta_\mathrm{tan}}{30} \\</span>
<span class="sd">        &amp; \mathrm{Y_{p,reaction}} = \begin{cases}</span>
<span class="sd">                A + BX^2 + CX^3 &amp;&amp; \text{if } \beta_\mathrm{tan} &lt; 30 \\</span>
<span class="sd">                A + B |X|^n &amp;&amp; \text{if } \beta_\mathrm{tan} \geq 30</span>
<span class="sd">              \end{cases}   </span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`s` is the pitch</span>
<span class="sd">        - :math:`c` is the chord</span>
<span class="sd">        - :math:`\beta_\mathrm{tan}` and :math:`\beta_\mathrm{ax}` is the exit relative flow angle with respect to tangential and axial direction. </span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r_sc : float</span>
<span class="sd">        Pitch-to-chord ratio.</span>
<span class="sd">    angle_out : float</span>
<span class="sd">        Exit relative flow angle (in degrees).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Pressure loss coefficient for impulse blades.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle_out</span>
    <span class="n">r_sc_min</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.46</span> <span class="o">+</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">77</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.614</span> <span class="o">+</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">130</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">phi</span> <span class="o">&gt;=</span> <span class="mi">30</span>
    <span class="p">)</span>  <span class="c1"># TODO: sigmoid blending to convert to smooth piecewise function</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">r_sc</span> <span class="o">-</span> <span class="n">r_sc_min</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.025</span> <span class="o">+</span> <span class="p">(</span><span class="mi">27</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">530</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&lt;</span> <span class="mi">27</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.025</span> <span class="o">+</span> <span class="p">(</span><span class="mi">27</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3085</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">phi</span> <span class="o">&gt;=</span> <span class="mi">27</span>
    <span class="p">)</span>  <span class="c1"># TODO: sigmoid blending to convert to smooth piecewise function</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mf">0.1583</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">1640</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mf">0.08</span> <span class="o">*</span> <span class="p">((</span><span class="n">phi</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">30</span>
    <span class="n">Yp_reaction</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">X</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">phi</span> <span class="o">&gt;=</span> <span class="mi">30</span>
    <span class="p">)</span>  <span class="c1"># TODO: sigmoid blending to convert to smooth piecewise function</span>
    <span class="k">return</span> <span class="n">Yp_reaction</span></div>



<div class="viewcode-block" id="impulse_blades">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.impulse_blades">[docs]</a>
<span class="k">def</span> <span class="nf">impulse_blades</span><span class="p">(</span><span class="n">r_sc</span><span class="p">,</span> <span class="n">angle_out</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use Aungier correlation to compute the pressure loss coefficient for impulse blades :cite:`aungier_turbine_2006`.</span>

<span class="sd">    This correlation is a formula that reproduces the figures from the Ainley and Mathieson original figures :cite:`ainley_method_1951`,</span>
<span class="sd">    and is a function of the pitch-to-chord ratio and exit relative flow angle. </span>

<span class="sd">    The correlation uses the following equations:</span>

<span class="sd">    .. math::</span>

<span class="sd">        &amp; \beta_\mathrm{tan} = 90 - \beta_\mathrm{ax} \\</span>
<span class="sd">        &amp; \left(\frac{s}{c}\right)_\mathrm{min} = 0.224 + 1.575\left(\frac{\beta_\mathrm{tan}}{90}\right) - \left(\frac{\beta_\mathrm{tan}}{90}\right)^2 \\</span>
<span class="sd">        &amp; X = \left(\frac{s}{c}\right) - \left(\frac{s}{c}\right)_\mathrm{min} \\</span>
<span class="sd">        &amp; A = 0.242 - \frac{\beta_\mathrm{tan}}{151} + \left(\frac{\beta_\mathrm{tan}}{127}\right)^2 \\</span>
<span class="sd">        &amp; B = \begin{cases}</span>
<span class="sd">                0.3 + \frac{30 - \beta_\mathrm{tan}}{50} &amp;&amp; \text{if } \beta_\mathrm{tan} &lt; 30 \\</span>
<span class="sd">                0.3 + \frac{30 - \beta_\mathrm{tan}}{275} &amp;&amp; \text{if } \beta_\mathrm{tan} \geq 30</span>
<span class="sd">              \end{cases} \\</span>
<span class="sd">        &amp; C = 0.88 - \frac{\beta_\mathrm{tan}}{42.4} + \left(\frac{\beta_\mathrm{tan}}{72.8}\right)^2 \\</span>
<span class="sd">        &amp; \mathrm{Y_{p,impulse}} = A + BX^2 - CX^3 </span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`s` is the pitch</span>
<span class="sd">        - :math:`c` is the chord</span>
<span class="sd">        - :math:`\beta_\mathrm{tan}` and :math:`\beta_\mathrm{ax}` is the exit relative flow angle with respect to tangential and axial direction. </span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    r_sc : float</span>
<span class="sd">        Pitch-to-chord ratio.</span>
<span class="sd">    angle_out : float</span>
<span class="sd">        Exit relative flow angle (in degrees).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Pressure loss coefficient for impulse blades.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">angle_out</span>
    <span class="n">r_sc_min</span> <span class="o">=</span> <span class="mf">0.224</span> <span class="o">+</span> <span class="mf">1.575</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">/</span> <span class="mi">90</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">phi</span> <span class="o">/</span> <span class="mi">90</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">r_sc</span> <span class="o">-</span> <span class="n">r_sc_min</span>
    <span class="n">A</span> <span class="o">=</span> <span class="mf">0.242</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">/</span> <span class="mi">151</span> <span class="o">+</span> <span class="p">(</span><span class="n">phi</span> <span class="o">/</span> <span class="mi">127</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">30</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.3</span> <span class="o">+</span> <span class="p">(</span><span class="mi">30</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">275</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">phi</span> <span class="o">&gt;=</span> <span class="mi">30</span>
    <span class="p">)</span>  <span class="c1"># TODO: sigmoid blending to convert to smooth piecewise function</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mf">0.88</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">/</span> <span class="mf">42.4</span> <span class="o">+</span> <span class="p">(</span><span class="n">phi</span> <span class="o">/</span> <span class="mf">72.8</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">Yp_impulse</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">C</span> <span class="o">*</span> <span class="n">X</span><span class="o">**</span><span class="mi">3</span>
    <span class="k">return</span> <span class="n">Yp_impulse</span></div>



<div class="viewcode-block" id="get_penetration_depth">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_penetration_depth">[docs]</a>
<span class="k">def</span> <span class="nf">get_penetration_depth</span><span class="p">(</span><span class="n">flow_parameters</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">delta_height</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculated the penetration depth of the passage vortex separation line relative to the blade span.</span>

<span class="sd">    The endwall inlet boundary layer generate a vortex which propagtes through the cascade section,</span>
<span class="sd">    and the spanwise penetration of this vortex affect the magnutude of the secondary loss coefficient.</span>
<span class="sd">    This function approximate the vortex penetration depth to the blade span by the correlation developed by :cite:`benner_empirical_2006-1`.</span>

<span class="sd">    The quantity is calculated as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \frac{\mathrm{Z_{te}}}{H} = \frac{0.10F_t^{0.79}}{\sqrt{CR}\left(\frac{H}{c}\right)^{0.55}} + 32.70\frac{\delta^*}{H}^2</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`CR = \frac{\cos(\beta_\mathrm{in})}{\cos(\beta_\mathrm{out})}` is the convergence ratio.</span>
<span class="sd">        - :math:`H` is the mean height.</span>
<span class="sd">        - :math:`c` is the chord.</span>
<span class="sd">        - :math:`\delta^*` is the inlet endwall boundary layer displacement thickness.</span>
<span class="sd">        - :math:`\beta_\mathrm{out}` is the exit relative flow angle.</span>
<span class="sd">        - :math:`F_t` is the tangential loading coefficient.</span>

<span class="sd">    The tangiential loading coefficient is calculated by a separate function (`F_t`).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    flow_parameters : dict</span>
<span class="sd">        Dictionary containing flow-related parameters.</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        Dictionary with geometric parameters.</span>
<span class="sd">    delta_height : float</span>
<span class="sd">        The inlet endwall boundary layer displacement thickness relative to the mean blade height.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Spanwise penetration depth of the passage vortex relative to the mean blade height.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: explain smoothing/blending tricks</span>

    <span class="n">beta_in</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_in&quot;</span><span class="p">]</span>
    <span class="n">beta_out</span> <span class="o">=</span> <span class="n">flow_parameters</span><span class="p">[</span><span class="s2">&quot;beta_out&quot;</span><span class="p">]</span>
    <span class="n">axial_chord</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;axial_chord&quot;</span><span class="p">]</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;pitch&quot;</span><span class="p">]</span>
    <span class="n">chord</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">]</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>

    <span class="n">CR</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">beta_in</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span>
        <span class="n">beta_out</span>
    <span class="p">)</span>  <span class="c1"># Convergence ratio from Benner et al.[2006]</span>

    <span class="n">BSx</span> <span class="o">=</span> <span class="n">axial_chord</span> <span class="o">/</span> <span class="n">pitch</span>  <span class="c1"># Axial blade solidity</span>
    <span class="n">delta_height</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">delta_height</span>  <span class="c1"># Boundary layer displacement thickness relative to blade height</span>
    <span class="p">)</span>
    <span class="n">AR</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">chord</span>  <span class="c1"># Aspect ratio</span>

    <span class="n">Ft</span> <span class="o">=</span> <span class="n">F_t</span><span class="p">(</span><span class="n">BSx</span><span class="p">,</span> <span class="n">beta_in</span><span class="p">,</span> <span class="n">beta_out</span><span class="p">)</span>

    <span class="n">Z_TE</span> <span class="o">=</span> <span class="mf">0.10</span> <span class="o">*</span> <span class="n">Ft</span><span class="o">**</span><span class="mf">0.79</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">CR</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">AR</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.55</span> <span class="o">+</span> <span class="mf">32.70</span> <span class="o">*</span> <span class="n">delta_height</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">Z_TE</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Z_TE</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">)</span>  <span class="c1"># TODO: smoothing</span>

    <span class="k">return</span> <span class="n">Z_TE</span></div>



<div class="viewcode-block" id="convert_kinetic_energy_coefficient">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.convert_kinetic_energy_coefficient">[docs]</a>
<span class="k">def</span> <span class="nf">convert_kinetic_energy_coefficient</span><span class="p">(</span><span class="n">dPhi</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">Ma_rel_out</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Convert the kinetic energy coefficient increment due to incidence to the total pressure loss coefficient according to the following correlation:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \mathrm{Y} = \frac{\left(1-\frac{\gamma -1}{2}\mathrm{Ma_{out}}^2(\frac{1}{(1-\Delta\phi^2_p)}-1)\right)^\frac{-\gamma}{\gamma - 1}-1}{1-\left(1 + \frac{\gamma - 1}{2}\mathrm{Ma_{out}}^2\right)^\frac{-\gamma}{\gamma - 1}}</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`\gamma` is the specific heat ratio.</span>
<span class="sd">        - :math:`\mathrm{Ma_{out}}` is the cascade exit relative mach number.</span>
<span class="sd">        - :math:`\Delta\phi^2_p` is the kinetic energy loss coefficient increment due to incidence.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dPhi : float</span>
<span class="sd">        Kinetic energy coefficient increment.</span>
<span class="sd">    gamma : float</span>
<span class="sd">        Heat capacity ratio.</span>
<span class="sd">    Ma_rel_out : float</span>
<span class="sd">        The cascade exit relative mach number.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The total pressure loss coefficient.</span>

<span class="sd">    Warnings</span>
<span class="sd">    --------</span>
<span class="sd">    This conversion assumes that the fluid is a perfect gas.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">denom</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ma_rel_out</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">gamma</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">numer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ma_rel_out</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">dPhi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span>
        <span class="o">-</span><span class="n">gamma</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">Y</span> <span class="o">=</span> <span class="n">numer</span> <span class="o">/</span> <span class="n">denom</span>

    <span class="k">return</span> <span class="n">Y</span></div>



<div class="viewcode-block" id="get_incidence_profile_loss_increment">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_incidence_profile_loss_increment">[docs]</a>
<span class="k">def</span> <span class="nf">get_incidence_profile_loss_increment</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">chi_extrapolation</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">loss_limit</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the increment in profile losses due to the effect of incidence according to the correlation proposed by :cite:`benner_influence_1997`.</span>

<span class="sd">    The increment in profile losses due to incidence is based on the incidence parameter :math:`\chi`.</span>
<span class="sd">    The formula used to compute :math:`\chi` is given by:</span>

<span class="sd">    .. math::</span>

<span class="sd">       \chi = We^{-0.2}\left(\frac{d}{s}\right)^{-0.05}  \left(\frac{\cos{\beta_1}}{\cos{\beta_2}} \right)^{-1.4}  \left(\alpha_1 - \alpha_{1,\mathrm{des}}\right)</span>

<span class="sd">    Depending on the value of :math:`\chi`, two equations are used for computing the increment in profile losses:</span>

<span class="sd">    1. For :math:`\chi \geq 0`:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \Delta \phi_{p}^2 = \sum_{i=1}^{8} a_i \, \chi^i</span>

<span class="sd">    with coefficients:</span>
<span class="sd">    </span>
<span class="sd">    .. math::</span>
<span class="sd">    </span>
<span class="sd">        a_1 = -6.149 \times 10^{-5}  \\</span>
<span class="sd">        a_2 = +1.327 \times 10^{-3}  \\</span>
<span class="sd">        a_3 = -2.506 \times 10^{-4}  \\</span>
<span class="sd">        a_4 = -1.542 \times 10^{-4}  \\</span>
<span class="sd">        a_5 = +9.017 \times 10^{-5}  \\</span>
<span class="sd">        a_6 = +1.106 \times 10^{-5}  \\</span>
<span class="sd">        a_7 = -5.318 \times 10^{-6}  \\</span>
<span class="sd">        a_8 = +3.711 \times 10^{-7}</span>

<span class="sd">    2. For :math:`\chi &lt; 0`:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \Delta \phi_{p}^2 = \sum_{i=1}^{2} b_i \, \chi^i</span>

<span class="sd">    with coefficients:</span>
<span class="sd">    </span>
<span class="sd">    .. math::</span>
<span class="sd">    </span>
<span class="sd">        b_1 = -8.720e-4 \times 10^{-4}  \\</span>
<span class="sd">        b_2 = +1.358e-4 \times 10^{-4}</span>
<span class="sd">    </span>
<span class="sd">    This function also implements two safeguard methods to prevent unrealistic values of the pressure loss increment</span>
<span class="sd">    when the value of :math:`\chi` is outside the range of validity of the correlation</span>

<span class="sd">    1. Linear extrapolation beyond a certain :math:`\chi`:</span>
<span class="sd">        Beyond a certain value of the distance parameter :math:`\hat{\chi}` the function linearly extrapolates based on the slope of the polynomial.</span>

<span class="sd">    2. Loss Limiting:</span>
<span class="sd">        The profile loss increment is limited to a maximum value :math:`\Delta \hat{\phi}_{p}^2` to prevent potential over-predictions. The limiting mechanism is smooth to ensure that the function is differentiable.</span>

<span class="sd">    The final expression for the loss coefficient increment can be summarized as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \begin{align}</span>
<span class="sd">        \Delta \phi_{p}^2 = </span>
<span class="sd">        \begin{cases}</span>
<span class="sd">        \sum_{i=1}^{2} b_i \, \chi^i &amp; \text{for } \chi &lt; 0 \\</span>
<span class="sd">        \sum_{i=1}^{8} a_i \, \chi^i &amp; \text{for } 0 \leq \chi  \leq \hat{\chi} \\</span>
<span class="sd">        \Delta\phi_{p}^2(\hat{\chi}) + \mathrm{slope}(\hat{\chi}) \cdot(\chi - \hat{\chi}) &amp; \text{for } \chi &gt; \hat{\chi}</span>
<span class="sd">        \end{cases}</span>
<span class="sd">        \end{align}</span>

<span class="sd">    .. math::</span>
<span class="sd">        \Delta \phi_{p}^2 = \mathrm{smooth\,min}(\Delta \phi_{p}^2, \Delta \hat{\phi}_{p}^2)</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    chi : array-like</span>
<span class="sd">        The distance parameter, :math:`\chi`, used to compute the profile losses increment.</span>
<span class="sd">    chi_extrapolation : float, optional</span>
<span class="sd">        The value of :math:`\chi` beyond which linear extrapolation is applied. Default is 5.</span>
<span class="sd">    loss_limit : float, optional</span>
<span class="sd">        The upper limit to which the profile loss increment is smoothly constrained. Default is 0.5.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    array-like</span>
<span class="sd">        Increment in profile losses due to the effect of incidence.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define the polynomial function for positive values of chi</span>
    <span class="n">coeffs_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="o">+</span><span class="mf">3.711e-7</span><span class="p">,</span>
            <span class="o">-</span><span class="mf">5.318e-6</span><span class="p">,</span>
            <span class="o">+</span><span class="mf">1.106e-5</span><span class="p">,</span>
            <span class="o">+</span><span class="mf">9.017e-5</span><span class="p">,</span>
            <span class="o">-</span><span class="mf">1.542e-4</span><span class="p">,</span>
            <span class="o">-</span><span class="mf">2.506e-4</span><span class="p">,</span>
            <span class="o">+</span><span class="mf">1.327e-3</span><span class="p">,</span>
            <span class="o">-</span><span class="mf">6.149e-5</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">func_1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeffs_1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)]),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Define the polynomial function for negative values of chi</span>
    <span class="n">coeffs_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.358e-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.72e-4</span><span class="p">])</span>
    <span class="n">func_2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeffs_2</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)]),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Calculate the profile losses increment based on polynomials</span>
    <span class="n">loss_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">chi</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">func_1</span><span class="p">(</span><span class="n">chi</span><span class="p">),</span> <span class="n">func_2</span><span class="p">(</span><span class="n">chi</span><span class="p">))</span>

    <span class="c1"># Apply linear extrapolation beyond the threshold for chi</span>
    <span class="n">_chi</span> <span class="o">=</span> <span class="n">chi_extrapolation</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">func_1</span><span class="p">(</span><span class="n">_chi</span><span class="p">)</span>
    <span class="n">coeffs_slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="o">*</span> <span class="n">a</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeffs_1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">a</span> <span class="o">*</span> <span class="n">_chi</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coeffs_slope</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">loss_extrap</span> <span class="o">=</span> <span class="n">loss</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">chi</span> <span class="o">-</span> <span class="n">_chi</span><span class="p">)</span>
    <span class="n">loss_increment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">chi</span> <span class="o">&gt;</span> <span class="n">_chi</span><span class="p">,</span> <span class="n">loss_extrap</span><span class="p">,</span> <span class="n">loss_poly</span><span class="p">)</span>

    <span class="c1"># Limit the loss to the loss_limit</span>
    <span class="k">if</span> <span class="n">loss_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">loss_increment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
            <span class="p">[</span><span class="n">loss_increment</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">loss_increment</span><span class="p">,</span> <span class="n">loss_limit</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">loss_increment</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">smooth_min</span><span class="p">(</span>
            <span class="n">loss_increment</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;logsumexp&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">loss_increment</span></div>



<div class="viewcode-block" id="get_incidence_parameter">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.get_incidence_parameter">[docs]</a>
<span class="k">def</span> <span class="nf">get_incidence_parameter</span><span class="p">(</span><span class="n">le</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">We</span><span class="p">,</span> <span class="n">theta_in</span><span class="p">,</span> <span class="n">theta_out</span><span class="p">,</span> <span class="n">beta_in</span><span class="p">,</span> <span class="n">beta_des</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the incidence parameter according to the correlation proposed by :cite:`benner_influence_1997`.</span>

<span class="sd">    The incidence parameter is used to calculate the increment in profile losses due to the effect of incidence according to function `get_incidence_profile_loss_increment`.</span>

<span class="sd">    The quantity is calculated as:</span>

<span class="sd">    .. math::</span>

<span class="sd">        \chi = \frac{\mathrm{d_{le}}}{s}^{-0.05}\mathrm{We_{le}}^{-0.2}\frac{\cos\theta_\mathrm{in}}{\cos\theta_\mathrm{out}}^{-1.4}(\beta_\mathrm{in} - \beta_\mathrm{des})</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`\mathrm{d_{le}}` is the leading edge diameter.</span>
<span class="sd">        - :math:`s` is the pitch.</span>
<span class="sd">        - :math:`\mathrm{We_{le}}` is the leading edge wedge angle.</span>
<span class="sd">        - :math:`\theta_\mathrm{in}` and :math:`\theta_\mathrm{out}` is the blade metal angle at the inlet and outlet respectively.</span>
<span class="sd">        - :math:`\beta_\mathrm{in}` and :math:`\beta_\mathrm{des}` is the inlet relative flow angle at given and design conditions respectively.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    le : float</span>
<span class="sd">        Leading edge diameter.</span>
<span class="sd">    s : float</span>
<span class="sd">        Pitch.</span>
<span class="sd">    We : float</span>
<span class="sd">        Leading edge wedge angle (in degrees).</span>
<span class="sd">    theta_in : float</span>
<span class="sd">        Leading edge metal angle (in degrees).</span>
<span class="sd">    theta_out : float</span>
<span class="sd">        Trailing edge metal angle (in degrees).</span>
<span class="sd">    beta_in : float</span>
<span class="sd">        Inlet relative flow angle (in degrees).</span>
<span class="sd">    beta_des : float</span>
<span class="sd">        Inlet relative flow angle at design condition (in degrees).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Incidence parameter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">chi</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">le</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">We</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">theta_in</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">theta_out</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.4</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">beta_in</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">beta_des</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">chi</span></div>



<div class="viewcode-block" id="F_t">
<a class="viewcode-back" href="../../../source/api/turboflow.axial_turbine.loss_model_benner.html#turboflow.axial_turbine.loss_model_benner.F_t">[docs]</a>
<span class="k">def</span> <span class="nf">F_t</span><span class="p">(</span><span class="n">BSx</span><span class="p">,</span> <span class="n">beta_in</span><span class="p">,</span> <span class="n">beta_out</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Calculate the tangential loading coefficient according to the correlation proposed by :cite:`benner_empirical_2006-1`.</span>

<span class="sd">    .. math::</span>

<span class="sd">        F_t = 2\frac{s}{c_\mathrm{ax}}\cos^2(\beta_m)(\tan(\beta_\mathrm{in} - \beta_\mathrm{out}))</span>

<span class="sd">    where:</span>

<span class="sd">        - :math:`s` is the pitch.</span>
<span class="sd">        - :math:`c_\mathrm{ax}` is the axial chord.</span>
<span class="sd">        - :math:`\beta_m = \tan^{-1}(0.5(\tan(\beta_\mathrm{in}) + \tan(\beta_\mathrm{out})))` is the mean vector angle.</span>
<span class="sd">        - :math:`\beta_\mathrm{in}` and :math:`\beta_\mathrm{out}` is the inlet and outlet relative flow angle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Bsx : float</span>
<span class="sd">        Blade solidity based on axial chord.</span>
<span class="sd">    beta_in : float</span>
<span class="sd">        Inlet relative flow angle (in degrees).</span>
<span class="sd">    beta_out : float</span>
<span class="sd">        Exit relative flow angle (in degrees).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Tangetnial loading parameter.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">a_m</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">arctand</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">beta_in</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">beta_out</span><span class="p">)))</span>

    <span class="n">F_t</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">2</span>
        <span class="o">*</span> <span class="mi">1</span>
        <span class="o">/</span> <span class="n">BSx</span>
        <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cosd</span><span class="p">(</span><span class="n">a_m</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="o">*</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">beta_in</span><span class="p">))</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tand</span><span class="p">(</span><span class="n">beta_out</span><span class="p">)))</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">F_t</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Lasse Borg Anderson and Roberto Agromayor.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>