<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>turboflow.plot_functions &mdash; turboflow v0.1.17 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=87e54e7c" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=abecb913" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=da59c74b"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script src="../../_static/design-tabs.js?v=f930bc37"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            turboflow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/model_description.html">Model Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/nomenclature.html">Nomenclature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/bibliography.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/api/turboflow.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/publications.html">Papers and Author Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/developer_guide.html">Developer guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">turboflow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">turboflow.plot_functions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for turboflow.plot_functions</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<div class="viewcode-block" id="load_data">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.load_data">[docs]</a>
<span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sheet_names</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load performance data from an Excel file.</span>

<span class="sd">    This function imports an Excel file containing performance parameters. It reads the data into a dictionary</span>
<span class="sd">    named &#39;performance_data&#39; where each key corresponds to a sheet name in the Excel file, and each value is</span>
<span class="sd">    a pandas DataFrame containing the data from that sheet. The data is rounded to avoid precision loss when</span>
<span class="sd">    loading from Excel.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name of the Excel file containing performance parameters.</span>
<span class="sd">    sheet_names : list</span>
<span class="sd">        List of the sheets to be exported. Default None extract all worksheets.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary containing performance data, where keys are sheet names and values are DataFrames.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Read excel file</span>
    <span class="n">performance_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_names</span>
    <span class="p">)</span>

    <span class="c1"># Round off to ignore precision loss by loading data from excel</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">performance_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">performance_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">performance_data</span></div>



<div class="viewcode-block" id="plot_lines">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_lines">[docs]</a>
<span class="k">def</span> <span class="nf">plot_lines</span><span class="p">(</span>
    <span class="n">performance_data</span><span class="p">,</span>
    <span class="n">x_key</span><span class="p">,</span>
    <span class="n">y_keys</span><span class="p">,</span>
    <span class="n">subsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">outdir</span><span class="o">=</span><span class="s2">&quot;figures&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">color_map</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">close_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">save_figs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">markers</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.png&quot;</span><span class="p">],</span>
    <span class="n">legend_loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot lines from performance data.</span>

<span class="sd">    This function plots lines from performance data. It supports plotting multiple lines on the same axes</span>
<span class="sd">    with customizable labels, colors, and linestyles. The resulting plot can be saved to a file if desired.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    performance_data : DataFrame</span>
<span class="sd">        The performance data to plot.</span>
<span class="sd">    x_key : str</span>
<span class="sd">        Name of the column in performance_data to be used as x-axis values.</span>
<span class="sd">    y_keys : list of str</span>
<span class="sd">        Names of the columns in performance_data to be plotted.</span>
<span class="sd">    subsets : list, optional</span>
<span class="sd">        Name and value of subsets to plot from performance_data. First instance should be a string representing the column name, while the</span>
<span class="sd">        remaining elemnts represet the values defining the subset. Default is None.</span>
<span class="sd">    fig : matplotlib.figure.Figure, optional</span>
<span class="sd">        An existing figure object. If None, a new figure is created.</span>
<span class="sd">    ax : matplotlib.axes.Axes, optional</span>
<span class="sd">        An existing axes object. If None, a new axes is created.</span>
<span class="sd">    xlabel : str, optional</span>
<span class="sd">        The label for the x-axis.</span>
<span class="sd">    ylabel : str, optional</span>
<span class="sd">        The label for the y-axis.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        The title of the plot.</span>
<span class="sd">    labels : list of str, optional</span>
<span class="sd">        Labels for the plotted lines. Default is None.</span>
<span class="sd">    filename : str, optional</span>
<span class="sd">        The filename for saving the figure. Default is None.</span>
<span class="sd">    outdir : str, optional</span>
<span class="sd">        The directory where figures should be saved. Default is &#39;figures&#39;.</span>
<span class="sd">    stack : bool, optional</span>
<span class="sd">        Whether to stack the plotted lines. Default is False.</span>
<span class="sd">    color_map : str, optional</span>
<span class="sd">        The colormap used for the lines. Default is &#39;viridis&#39;.</span>
<span class="sd">    colors : list of str or colors, optional</span>
<span class="sd">        Colors for the plotted lines. Default is None.</span>
<span class="sd">    close_fig : bool, optional</span>
<span class="sd">        Whether to close the figure after plotting. Default is False.</span>
<span class="sd">    save_figs : bool, optional</span>
<span class="sd">        Whether to save the figure. Default is False.</span>
<span class="sd">    linestyles : list of str, optional</span>
<span class="sd">        Linestyles for the plotted lines. Default is None.</span>
<span class="sd">    save_formats : list of str, optional</span>
<span class="sd">        File formats for saving the figure. Default is [&#39;.png&#39;].</span>
<span class="sd">    legend_loc : str, optional</span>
<span class="sd">        Location for the legend. Default is &#39;best&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.figure.Figure</span>
<span class="sd">        The figure object.</span>
<span class="sd">    matplotlib.axes.Axes</span>
<span class="sd">        The axes object.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create figure if not provided</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.4</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">))</span>

    <span class="c1"># Specify title and axes labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="c1"># Get data</span>
    <span class="k">if</span> <span class="n">subsets</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">x_key</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">y_keys</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">x_key</span><span class="p">,</span> <span class="n">subsets</span><span class="o">=</span><span class="n">subsets</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">get_lines</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">y_keys</span><span class="p">,</span> <span class="n">subsets</span><span class="o">=</span><span class="n">subsets</span><span class="p">)</span>

    <span class="c1"># Get colors</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">color_map</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>

    <span class="c1"># Get labels</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">subsets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">subsets</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">subsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">subsets</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subsets</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">y_keys</span>

    <span class="c1"># Get linestyles</span>
    <span class="k">if</span> <span class="n">linestyles</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">markers</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;none&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Plot figure</span>
    <span class="k">if</span> <span class="n">subsets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">subsets</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">subsets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stack</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
            <span class="c1"># Add edges by overlaying lines</span>
            <span class="n">y_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">series</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
            <span class="n">cumulative_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">y_arrays</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_arrays</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">series</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cumulative_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
    <span class="k">elif</span> <span class="n">subsets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stack</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">stackplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
            <span class="c1"># Add edges by overlaying lines</span>
            <span class="n">y_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">series</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
            <span class="n">cumulative_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">y_arrays</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y_arrays</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">series</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cumulative_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;x_keys and y_keys are not well defined&quot;</span><span class="p">)</span>

    <span class="c1"># Set margins to zero</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

    <span class="c1"># Add legend</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">w_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Create output directory if it does not exist</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

    <span class="c1"># Save figure</span>
    <span class="k">if</span> <span class="n">save_figs</span><span class="p">:</span>
        <span class="n">base_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">savefig_in_formats</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">base_filename</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="n">save_formats</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">close_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="get_lines">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.get_lines">[docs]</a>
<span class="k">def</span> <span class="nf">get_lines</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">subsets</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve lines of data from the specified column in `performance_data`.</span>

<span class="sd">    This function returns a list of array from the specified column(s) of the performance data.</span>
<span class="sd">    If no subset is specified, it returns lines covering all rows in `performance_data`. If a subset</span>
<span class="sd">    is specified, it returns lines covering only the rows that match the specified subset.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    performance_data : DataFrame</span>
<span class="sd">        The DataFrame containing the performance data.</span>
<span class="sd">    column_name : str or list of str</span>
<span class="sd">        The name(s) of the column(s) from which to retrieve data.</span>
<span class="sd">    subsets : list, optional</span>
<span class="sd">        Name and value of subsets to get data from performance_data. First instance should be a string representing the column name, while the</span>
<span class="sd">        remaining elemnts represet the values defining the subset. Default is None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        A list of arrays from the specified column(s) of performance_data.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get lines covering all rows in performance_data</span>
    <span class="k">if</span> <span class="n">subsets</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Get single line</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">get_column</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)</span>
        <span class="c1"># Get several columns</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_name</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_column</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">lines</span>

    <span class="n">subsets</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">subsets</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="c1"># Get lines covering given subset</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">subsets</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">get_subset</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">subsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_column</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)[</span><span class="n">indices</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">column_name</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">get_subset</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">subsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">val</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_column</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column</span><span class="p">)[</span><span class="n">indices</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">lines</span></div>



<div class="viewcode-block" id="find_column">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.find_column">[docs]</a>
<span class="k">def</span> <span class="nf">find_column</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the sheet containing the specified column in `performance_data`.</span>

<span class="sd">    This function searches through all sheets in `performance_data` to find the one containing the specified column.</span>
<span class="sd">    If the column is found, it returns the name of the sheet. If the column is not found, it raises an exception.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    performance_data : dict</span>
<span class="sd">        A dictionary containing sheets of performance data, where keys are sheet names and values are DataFrames.</span>
<span class="sd">    column_name : str</span>
<span class="sd">        The name of the column to find.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The name of the sheet containing the specified column.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    Exception</span>
<span class="sd">        If the specified column is not found in any sheet of performance_data.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">performance_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">element</span> <span class="o">==</span> <span class="n">column_name</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">performance_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">key</span>

    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find column </span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2"> in performance_data&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_column">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.get_column">[docs]</a>
<span class="k">def</span> <span class="nf">get_column</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a column of data from `performance_data`.</span>

<span class="sd">    This function retrieves the specified column of data from `performance_data` by finding the sheet containing</span>
<span class="sd">    the column using the `find_column` function. It then returns the column as a pandas Series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    performance_data : dict</span>
<span class="sd">        A dictionary containing sheets of performance data, where keys are sheet names and values are DataFrames.</span>
<span class="sd">    column_name : str</span>
<span class="sd">        The name of the column to retrieve.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Series</span>
<span class="sd">        The column of data corresponding to column_name.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sheet</span> <span class="o">=</span> <span class="n">find_column</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">performance_data</span><span class="p">[</span><span class="n">sheet</span><span class="p">][</span><span class="n">column_name</span><span class="p">]</span></div>



<div class="viewcode-block" id="get_subset">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.get_subset">[docs]</a>
<span class="k">def</span> <span class="nf">get_subset</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">row_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the index of rows in `performance_data` where `column_name` equals `row_value`.</span>

<span class="sd">    This function retrieves the index of rows in `performance_data` where the specified column (`column_name`)</span>
<span class="sd">    equals the specified value (`row_value`). It first finds the sheet containing the column using the</span>
<span class="sd">    `find_column` function, then returns the index of rows where the column has the specified value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    performance_data : dict</span>
<span class="sd">        A dictionary containing sheets of performance data, where keys are sheet names and values are DataFrames.</span>
<span class="sd">    column_name : str</span>
<span class="sd">        The name of the column to search for `row_value`.</span>
<span class="sd">    row_value : object</span>
<span class="sd">        The value to match in `column_name`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.Index</span>
<span class="sd">        The index of rows where `column_name` equals `row_value`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sheet</span> <span class="o">=</span> <span class="n">find_column</span><span class="p">(</span><span class="n">performance_data</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">performance_data</span><span class="p">[</span><span class="n">sheet</span><span class="p">][</span>
        <span class="n">performance_data</span><span class="p">[</span><span class="n">sheet</span><span class="p">][</span><span class="n">column_name</span><span class="p">]</span> <span class="o">==</span> <span class="n">row_value</span>
    <span class="p">]</span><span class="o">.</span><span class="n">index</span></div>



<div class="viewcode-block" id="savefig_in_formats">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.savefig_in_formats">[docs]</a>
<span class="k">def</span> <span class="nf">savefig_in_formats</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">path_without_extension</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;.eps&quot;</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a given matplotlib figure in multiple file formats.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : matplotlib.figure.Figure</span>
<span class="sd">        The figure object to be saved.</span>
<span class="sd">    path_without_extension : str</span>
<span class="sd">        The full path to save the figure excluding the file extension.</span>
<span class="sd">    formats : list of str, optional</span>
<span class="sd">        A list of string file extensions to specify which formats the figure should be saved in.</span>
<span class="sd">        Default is [&#39;.png&#39;, &#39;.svg&#39;, &#39;.pdf&#39;, &quot;.eps&quot;].</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot([0, 1], [0, 1])</span>
<span class="sd">    &gt;&gt;&gt; save_fig_in_formats(fig, &quot;/path/to/figure/filename&quot;)</span>

<span class="sd">    This will save the figure as &quot;filename.png&quot;, &quot;filename.svg&quot;, and &quot;filename.pdf&quot; in the &quot;/path/to/figure/&quot; directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path_without_extension</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="plot_axial_radial_plane">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_axial_radial_plane">[docs]</a>
<span class="k">def</span> <span class="nf">plot_axial_radial_plane</span><span class="p">(</span><span class="n">geometry</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the turbine geometry in an axial-radial plane.</span>

<span class="sd">    This function plots the turbine geometry in an axial-radial plane. It takes the turbine geometry data</span>
<span class="sd">    as input, including the radii at the inner and outer hub and tip, the number of cascades, and the axial</span>
<span class="sd">    chord lengths. It then constructs and displays the plot, which represents the turbine blades in the</span>
<span class="sd">    axial-radial plane.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    geometry : dict</span>
<span class="sd">        A dictionary containing turbine geometry data including:</span>

<span class="sd">        - `radius_hub_in` (array-like) : Inner hub radii at each cascade.</span>
<span class="sd">        - `radius_hub_out` (array-like) : Outer hub radii at each cascade.</span>
<span class="sd">        - `radius_tip_in` (array-like) : Inner tip radii at each cascade.</span>
<span class="sd">        - `radius_tip_out` (array-like) : Outer tip radii at each cascade.</span>
<span class="sd">        - `number_of_cascades` (int) : Number of cascades in the turbine.</span>
<span class="sd">        - `axial_chord` (array-like) : Axial chord lengths at each cascade.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.figure.Figure</span>
<span class="sd">        The generated figure.</span>
<span class="sd">    matplotlib.axes.Axes</span>
<span class="sd">        The generated axes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load data</span>
    <span class="n">radius_hub_in</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_hub_in&quot;</span><span class="p">]</span>
    <span class="n">radius_hub_out</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_hub_out&quot;</span><span class="p">]</span>
    <span class="n">radius_tip_in</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_tip_in&quot;</span><span class="p">]</span>
    <span class="n">radius_tip_out</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;radius_tip_out&quot;</span><span class="p">]</span>
    <span class="n">number_of_cascades</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;number_of_cascades&quot;</span><span class="p">]</span>
    <span class="n">axial_chord</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;axial_chord&quot;</span><span class="p">]</span>
    <span class="n">tip_clearance</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">&quot;tip_clearance&quot;</span><span class="p">]</span>

    <span class="c1"># Define unspecified geometrical parameters</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># Thickness of casing relative to maximum tip radius</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="mf">1.2</span>  <span class="c1"># Length of casing to turbine</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Axial spacing between cascades relative to max axial chord</span>

    <span class="c1"># Get x-points</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">cs</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">axial_chord</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axial_chord</span><span class="p">)):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axial_chord</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axial_chord</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Get tip and hub points</span>
    <span class="n">y_hub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">radius_hub_in</span><span class="p">,</span> <span class="n">radius_hub_out</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">y_tip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">radius_tip_in</span><span class="p">,</span> <span class="n">radius_tip_out</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Initialize figure and axis object</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="c1"># Plot upper casing</span>
    <span class="n">tip_clearance_extended</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tip_clearance</span><span class="p">,</span> <span class="n">tip_clearance</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># Extend tip clearance vector</span>
    <span class="n">casing_thickness</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_tip</span><span class="p">)</span> <span class="o">*</span> <span class="n">ct</span>
    <span class="n">x_casing</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">x_casing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x_casing</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">cl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">x_casing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_casing</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">cl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">y_casing_lower</span> <span class="o">=</span> <span class="n">y_tip</span> <span class="o">+</span> <span class="n">tip_clearance_extended</span>
    <span class="n">y_casing_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y_casing_lower</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y_casing_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_casing_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_casing_lower</span><span class="p">,</span> <span class="n">y_casing_lower</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">y_casing_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_casing</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y_tip</span><span class="p">)</span> <span class="o">+</span> <span class="n">casing_thickness</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_casing</span><span class="p">,</span> <span class="n">y_casing_lower</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_casing</span><span class="p">,</span> <span class="n">y_casing_upper</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_casing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_casing</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">y_casing_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_casing_upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_casing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_casing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">y_casing_lower</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_casing_upper</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_casing</span><span class="p">,</span> <span class="n">y_casing_lower</span><span class="p">,</span> <span class="n">y_casing_upper</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>

    <span class="c1"># Plot lower casing</span>
    <span class="n">tip_clearance_extended</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">val</span>
            <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">tip_clearance</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">tip_clearance</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span>
        <span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># Extend tip clearance vector</span>
    <span class="n">y_casing_upper</span> <span class="o">=</span> <span class="n">y_hub</span> <span class="o">-</span> <span class="n">tip_clearance_extended</span>
    <span class="n">y_casing_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y_casing_upper</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y_casing_upper</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_casing_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_casing_upper</span><span class="p">,</span> <span class="n">y_casing_upper</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">y_casing_lower</span> <span class="o">=</span> <span class="n">y_casing_upper</span> <span class="o">-</span> <span class="n">casing_thickness</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_casing</span><span class="p">,</span> <span class="n">y_casing_lower</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_casing</span><span class="p">,</span> <span class="n">y_casing_upper</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_casing</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_casing</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">y_casing_lower</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_casing_upper</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_casing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_casing</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">y_casing_lower</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_casing_upper</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_casing</span><span class="p">,</span> <span class="n">y_casing_lower</span><span class="p">,</span> <span class="n">y_casing_upper</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.5&quot;</span><span class="p">)</span>

    <span class="c1"># Plot cascades</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_cascades</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span> <span class="n">y_tip</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>  <span class="c1"># Plot tip</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span> <span class="n">y_hub</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>  <span class="c1"># Plot hub</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">y_hub</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_tip</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
            <span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># Plot inlet vertical line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">y_hub</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">y_tip</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
            <span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># Plot exit vertical line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">y_hub</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">y_tip</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># Fill cascade with color</span>

    <span class="c1"># Plot axis of rotation</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># ax.set_yticks([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># ax.spines[&#39;left&#39;].set_visible(False)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Axis of rotation&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Radius&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">lims</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">lims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_velocity_triangle_stage">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_velocity_triangle_stage">[docs]</a>
<span class="k">def</span> <span class="nf">plot_velocity_triangle_stage</span><span class="p">(</span><span class="n">plane</span><span class="p">,</span>
                                 <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">linestyle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                 <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
                                 <span class="n">hs</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
                                 <span class="n">start_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="n">start_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                 <span class="n">dy</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
                                 <span class="n">dx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot velocity triangles for each stage of a turbine.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    plane : pandas.DataFrame</span>
<span class="sd">        A DataFrame containing velocity components for each plane of the turbine.</span>
<span class="sd">        The DataFrame should have the following keys:</span>
<span class="sd">        - &#39;v_m&#39;: Meridional velocities.</span>
<span class="sd">        - &#39;v_t&#39;: Tangential velocities.</span>
<span class="sd">        - &#39;w_m&#39;: Meridional velocities of relative motion.</span>
<span class="sd">        - &#39;w_t&#39;: Tangential velocities of relative motion.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.figure.Figure</span>
<span class="sd">        The matplotlib figure object containing the velocity triangle plot.</span>

<span class="sd">    matplotlib.axes._subplots.AxesSubplot</span>
<span class="sd">        The matplotlib axis object containing the velocity triangle plot.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get indices of inlet and exit of each rotor plane</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">plane</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">4</span><span class="p">],</span> <span class="n">plane</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">4</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">plane</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

    <span class="c1"># Load variables</span>
    <span class="n">v_ms</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;v_m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">v_ts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;v_t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">w_ms</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;w_m&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">w_ts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;w_t&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Get maximum an minimum tangential velocities</span>
    <span class="n">max_w_t</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v_ts</span><span class="p">,</span> <span class="n">w_ts</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]))</span>
    <span class="n">min_w_t</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v_ts</span><span class="p">,</span> <span class="n">w_ts</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]))</span>

    <span class="c1"># initialize figure and axis</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="c1"># Calculate number of stages</span>
    <span class="n">number_of_stages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plane</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>

    <span class="c1"># Plot stage velocity triangles</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_stages</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_velocity_triangle</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span><span class="p">,</span> <span class="n">w_ts</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="n">v_ts</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="n">v_ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="n">w_ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="n">hs</span> <span class="o">=</span> <span class="n">hs</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_velocity_triangle</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span><span class="p">,</span> <span class="n">w_ts</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">v_ts</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">v_ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">w_ms</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">hs</span> <span class="o">=</span> <span class="n">hs</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">start_x</span> <span class="o">+=</span> <span class="n">dx</span>
        <span class="n">start_y</span> <span class="o">+=</span> <span class="n">dy</span>

    <span class="c1"># Set plot options</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_velocity_triangle">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_velocity_triangle">[docs]</a>
<span class="k">def</span> <span class="nf">plot_velocity_triangle</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span><span class="p">,</span> <span class="n">w_t</span><span class="p">,</span> <span class="n">v_t</span><span class="p">,</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">w_m</span><span class="p">,</span> <span class="n">hs</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">lines</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="c1"># Plot triangle</span>
    <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">start_x</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>  <span class="c1"># Plot meridional velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot absolute tangential velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">w_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot relative tangential velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot abolsute velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">w_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot relative velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">w_t</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot blade speed</span>
    <span class="k">elif</span> <span class="n">lines</span> <span class="o">==</span> <span class="s2">&quot;total&quot;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>  <span class="c1"># Plot abolsute velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">w_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot relative velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">w_t</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot blade speed</span>
    <span class="k">elif</span> <span class="n">lines</span> <span class="o">==</span> <span class="s2">&quot;absolute&quot;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">start_x</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>  <span class="c1"># Plot meridional velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot absolute tangential velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot abolsute velocity</span>
    <span class="k">elif</span> <span class="n">lines</span> <span class="o">==</span> <span class="s2">&quot;relative&quot;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">start_x</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">)</span>  <span class="c1"># Plot meridional velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">w_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot relative tangential velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_x</span><span class="p">,</span> <span class="n">w_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot relative velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">w_t</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">)</span>  <span class="c1"># Plot blade speed</span>

    <span class="c1"># Arrows</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">v_t</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">start_y</span> <span class="o">+</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span><span class="p">),</span>
        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">),</span>
    <span class="p">)</span>  <span class="c1"># Arrow for absolute velocity</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">w_t</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">start_y</span> <span class="o">+</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span><span class="p">),</span>
                <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">),</span>
            <span class="p">)</span>  <span class="c1"># Arrow for relative velocity</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">((</span><span class="n">w_t</span> <span class="o">+</span> <span class="n">v_t</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">),</span>
                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">w_t</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">),</span>
                <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span><span class="p">),</span>
            <span class="p">)</span>  <span class="c1"># Arrow for blade speed</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_velocity_triangles_planes">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_velocity_triangles_planes">[docs]</a>
<span class="k">def</span> <span class="nf">plot_velocity_triangles_planes</span><span class="p">(</span><span class="n">plane</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot velocity triangles for each plane of a turbine.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    plane : pandas.DataFrame</span>
<span class="sd">        A DataFrame containing velocity components for each plane of the turbine.</span>
<span class="sd">        The DataFrame should have the following keys:</span>
<span class="sd">        - &#39;v_m&#39;: Meridional velocities.</span>
<span class="sd">        - &#39;v_t&#39;: Tangential velocities.</span>
<span class="sd">        - &#39;w_m&#39;: Meridional velocities of relative motion.</span>
<span class="sd">        - &#39;w_t&#39;: Tangential velocities of relative motion.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    matplotlib.figure.Figure</span>
<span class="sd">        The matplotlib figure object containing the velocity triangle plot.</span>

<span class="sd">    matplotlib.axes._subplots.AxesSubplot</span>
<span class="sd">        The matplotlib axis object containing the velocity triangle plot.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load variables</span>
    <span class="n">v_ms</span> <span class="o">=</span> <span class="n">plane</span><span class="p">[</span><span class="s2">&quot;v_m&quot;</span><span class="p">]</span>
    <span class="n">v_ts</span> <span class="o">=</span> <span class="n">plane</span><span class="p">[</span><span class="s2">&quot;v_t&quot;</span><span class="p">]</span>
    <span class="n">w_ms</span> <span class="o">=</span> <span class="n">plane</span><span class="p">[</span><span class="s2">&quot;w_m&quot;</span><span class="p">]</span>
    <span class="n">w_ts</span> <span class="o">=</span> <span class="n">plane</span><span class="p">[</span><span class="s2">&quot;w_t&quot;</span><span class="p">]</span>

    <span class="c1"># Get maximum an minimum tangential velocities</span>
    <span class="n">max_w_t</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v_ts</span><span class="p">,</span> <span class="n">w_ts</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]))</span>
    <span class="n">min_w_t</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">v_ts</span><span class="p">,</span> <span class="n">w_ts</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]))</span>

    <span class="c1"># Nameing of planes (for marking)</span>
    <span class="n">plane_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;inlet&quot;</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="p">]</span>

    <span class="c1"># Tuning options</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Spacing between triangles</span>
    <span class="n">hs</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Horizontal spacing between line and symbol (absolute)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Starting point in y direction</span>
    <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c1"># Fontsize</span>

    <span class="c1"># Get rotor indexes</span>
    <span class="n">i_rotor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">plane</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">4</span><span class="p">],</span> <span class="n">plane</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">3</span><span class="p">::</span><span class="mi">4</span><span class="p">])</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pair</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># initialize figure and axis</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="c1"># Plot velocity triangles</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plane</span><span class="p">)):</span>

        <span class="n">v_m</span> <span class="o">=</span> <span class="n">v_ms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">v_t</span> <span class="o">=</span> <span class="n">v_ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">w_m</span> <span class="o">=</span> <span class="n">w_ms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">w_t</span> <span class="o">=</span> <span class="n">w_ts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Define cascade name</span>
        <span class="n">cascade</span> <span class="o">=</span> <span class="s2">&quot;Stator&quot;</span>  <span class="c1"># Changed if rotor (see below)</span>

        <span class="c1"># Plot absolute velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span>
        <span class="p">)</span>  <span class="c1"># Plot meridional velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span>
        <span class="p">)</span>  <span class="c1"># Plot tangntial velocity</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>  <span class="c1"># Plot velocity</span>
        <span class="n">x_mid</span> <span class="o">=</span> <span class="n">v_t</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">y_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">start</span> <span class="o">-</span> <span class="n">v_m</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_mid</span><span class="p">,</span> <span class="n">y_mid</span><span class="p">),</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span>
            <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">),</span>
        <span class="p">)</span>  <span class="c1"># Arrow for absolute velocity</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x_mid</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">x_mid</span> <span class="o">+</span> <span class="n">hs</span> <span class="o">*</span> <span class="n">sign</span><span class="p">,</span>
            <span class="n">y_mid</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;$v$&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="p">)</span>  <span class="c1"># Symbol for absolute velocity</span>

        <span class="c1"># Plot relative velocity</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">i_rotor</span><span class="p">:</span>

            <span class="n">cascade</span> <span class="o">=</span> <span class="s2">&quot;Rotor&quot;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">w_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span>
            <span class="p">)</span>  <span class="c1"># Plot tangntial velocity</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">w_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>  <span class="c1"># Plot velocity</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">w_t</span><span class="p">,</span> <span class="n">v_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">],</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>  <span class="c1"># Plot blade speed</span>
            <span class="n">x_mid</span> <span class="o">=</span> <span class="n">w_t</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">y_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_mid</span><span class="p">,</span> <span class="n">y_mid</span><span class="p">),</span>
                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start</span><span class="p">),</span>
                <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">),</span>
            <span class="p">)</span>  <span class="c1"># Arrow for relative velocity</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x_mid</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">x_mid</span> <span class="o">+</span> <span class="n">hs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x_mid</span><span class="p">),</span>
                <span class="n">y_mid</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;$w$&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># Symbol for relative velocity</span>
            <span class="n">x_mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_t</span> <span class="o">+</span> <span class="n">v_t</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">y_mid</span> <span class="o">=</span> <span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_mid</span><span class="p">,</span> <span class="n">y_mid</span><span class="p">),</span>
                <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">w_t</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span><span class="p">),</span>
                <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-|&gt;&quot;</span><span class="p">),</span>
            <span class="p">)</span>  <span class="c1"># Arrow for blade speed</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">x_mid</span><span class="p">,</span>
                <span class="n">y_mid</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;$u$&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>  <span class="c1"># Symbol for blade speed</span>

        <span class="c1"># Add explanatory text</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v_t</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">w_t</span><span class="p">):</span>
            <span class="n">tangential_component</span> <span class="o">=</span> <span class="n">v_t</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tangential_component</span> <span class="o">=</span> <span class="n">w_t</span>
        <span class="k">if</span> <span class="n">tangential_component</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">max_w_t</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">start</span> <span class="o">-</span> <span class="n">v_m</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cascade</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">plane_name</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">min_w_t</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">start</span> <span class="o">-</span> <span class="n">v_m</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cascade</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">plane_name</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Plot line diciding the different triangles</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">min_w_t</span><span class="p">,</span> <span class="n">max_w_t</span><span class="p">],</span> <span class="p">[</span><span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">v_m</span><span class="p">,</span> <span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">v_m</span><span class="p">],</span> <span class="s2">&quot;k:&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Update starting point for the next velocity triangle</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">-</span> <span class="n">w_m</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">v_m</span>

    <span class="c1"># Set plot options</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="combine_multiple_figures">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.combine_multiple_figures">[docs]</a>
<span class="k">def</span> <span class="nf">combine_multiple_figures</span><span class="p">(</span><span class="n">figures</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_labels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine multiple matplotlib figures into a single figure with custom labels, markers, linestyles, and colors.</span>

<span class="sd">    This function extracts the lines from all axes of the given figures </span>
<span class="sd">    and plots them onto a new figure. The resulting figure contains </span>
<span class="sd">    the plots from all corresponding axes in the input figures, with </span>
<span class="sd">    custom labels, markers, linestyles, and colors applied to each line.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    figures : list of matplotlib.figure.Figure</span>
<span class="sd">        The list of figures to be combined.</span>
<span class="sd">    labels : list of str, optional</span>
<span class="sd">        The list of labels. </span>
<span class="sd">        If not provided, default labels &#39;fig1&#39;, &#39;fig2&#39;, etc. will be used.</span>
<span class="sd">    markers : list of str, optional</span>
<span class="sd">        The list of markers to use for the lines from each figure. If not </span>
<span class="sd">        provided, default markers will be used.</span>
<span class="sd">    linestyles : list of str, optional</span>
<span class="sd">        The list of linestyles to use for the lines from each figure. If not </span>
<span class="sd">        provided, default linestyles will be used.</span>
<span class="sd">    colors : list of str, optional</span>
<span class="sd">        The list of colors to use for the lines from each figure. If not </span>
<span class="sd">        provided, default colors will be used.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure</span>
<span class="sd">        The new figure containing the combined plots.</span>
<span class="sd">    axes : list of matplotlib.axes.Axes</span>
<span class="sd">        The list of axes objects in the new figure.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; fig1, ax1 = plt.subplots(2, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax1[0].plot([1, 2, 3], [1, 4, 9], label=&#39;Plot 1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax1[1].plot([1, 2, 3], [1, 2, 3], label=&#39;Plot 2&#39;)</span>
<span class="sd">    &gt;&gt;&gt; fig2, ax2 = plt.subplots(2, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax2[0].plot([1, 2, 3], [9, 4, 1], label=&#39;Plot 3&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax2[1].plot([1, 2, 3], [3, 2, 1], label=&#39;Plot 4&#39;)</span>
<span class="sd">    &gt;&gt;&gt; fig3, ax3 = plt.subplots(2, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax3[0].plot([1, 2, 3], [2, 3, 4], label=&#39;Plot 5&#39;)</span>
<span class="sd">    &gt;&gt;&gt; fig, axes = combine_multiple_figures(</span>
<span class="sd">    &gt;&gt;&gt;     [fig1, fig2, fig3], </span>
<span class="sd">    &gt;&gt;&gt;     labels=[&#39;Figure 1&#39;, &#39;Figure 2&#39;, &#39;Figure 3&#39;],</span>
<span class="sd">    &gt;&gt;&gt;     markers=[&#39;o&#39;, &#39;s&#39;, &#39;d&#39;],</span>
<span class="sd">    &gt;&gt;&gt;     linestyles=[&#39;-&#39;, &#39;--&#39;, &#39;:&#39;],</span>
<span class="sd">    &gt;&gt;&gt;     colors=[&#39;blue&#39;, &#39;green&#39;, &#39;red&#39;]</span>
<span class="sd">    &gt;&gt;&gt; )</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fig</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">))]</span>
    
    <span class="k">if</span> <span class="n">markers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of labels must match the number of figures.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of markers must match the number of figures.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linestyles</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of linestyles must match the number of figures.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">figures</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of colors must match the number of figures.&quot;</span><span class="p">)</span>

    <span class="c1"># Determine the maximum number of axes across all figures</span>
    <span class="n">max_num_axes</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">())</span> <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">figures</span><span class="p">)</span>

    <span class="c1"># Set y_labels</span>
    <span class="k">if</span> <span class="n">y_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">y_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">max_num_axes</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_labels</span><span class="p">)</span> <span class="o">!=</span> <span class="n">max_num_axes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The number of y-axis labels must match the number of axes.&quot;</span><span class="p">)</span>

    <span class="c1"># Create a new figure with the same number of subplots as the maximum number of axes</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">max_num_axes</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Flatten axes to make iteration easier</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Combine plots from all figures</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_num_axes</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">figures</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span> <span class="n">colors</span><span class="p">)):</span>
            <span class="n">axes_list</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes_list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">axes_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_lines</span><span class="p">():</span>
                    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">line</span><span class="o">.</span><span class="n">get_xdata</span><span class="p">(),</span> 
                        <span class="n">line</span><span class="o">.</span><span class="n">get_ydata</span><span class="p">(),</span> 
                        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> 
                        <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> 
                        <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span> 
                        <span class="n">color</span><span class="o">=</span><span class="n">color</span>
                    <span class="p">)</span>

        <span class="c1"># axis options</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>



<div class="viewcode-block" id="plot_optimization_results">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_optimization_results">[docs]</a>
<span class="k">def</span> <span class="nf">plot_optimization_results</span><span class="p">(</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">lower_bounds</span><span class="p">,</span> <span class="n">upper_bounds</span><span class="p">,</span> <span class="n">final_solutions</span><span class="p">,</span> 
                              <span class="n">markers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">variable_names</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">markersizes</span> <span class="o">=</span> <span class="mi">6</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the relative change from the initial guess for each variable,</span>
<span class="sd">    along with the bounds as an error bar style plot.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    initial_guess : np.ndarray</span>
<span class="sd">        Array of initial guesses for the design variables.</span>
<span class="sd">    lower_bounds : list of float</span>
<span class="sd">        List of lower bounds for each design variable.</span>
<span class="sd">    upper_bounds : list of float</span>
<span class="sd">        List of upper bounds for each design variable.</span>
<span class="sd">    final_solutions : list of np.ndarray</span>
<span class="sd">        List of arrays where each array represents a set of final optimized design variables.</span>
<span class="sd">    markers : list of str, optional</span>
<span class="sd">        List of markers to use for each set of final solutions. Default is &#39;o&#39;.</span>
<span class="sd">    colors : list of str, optional</span>
<span class="sd">        List of colors to use for each set of final solutions. Default is &#39;b&#39;, &#39;g&#39;, &#39;r&#39;, etc.</span>
<span class="sd">    fig : matplotlib.figure.Figure, optional</span>
<span class="sd">        Matplotlib Figure object. If not provided, a new figure will be created.</span>
<span class="sd">    ax : matplotlib.axes.Axes, optional</span>
<span class="sd">        Matplotlib Axes object. If not provided, a new axes will be created.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure</span>
<span class="sd">        The Figure object containing the plot.</span>
<span class="sd">    ax : matplotlib.axes.Axes</span>
<span class="sd">        The Axes object containing the plot.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; initial_guess = np.array([1.0, 2.0, 3.0])</span>
<span class="sd">    &gt;&gt;&gt; lower_bounds = [0.5, 1.0, 2.0]</span>
<span class="sd">    &gt;&gt;&gt; upper_bounds = [1.5, 3.0, 4.0]</span>
<span class="sd">    &gt;&gt;&gt; final_solutions = [np.array([1.1, 2.5, 2.8]), np.array([0.9, 2.1, 3.2])]</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plot_optimization_results(initial_guess, lower_bounds, upper_bounds, final_solutions)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_vars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_guess</span><span class="p">)</span>
    
    <span class="c1"># Convert lower and upper bounds to numpy arrays</span>
    <span class="n">lower_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lower_bounds</span><span class="p">)</span>
    <span class="n">upper_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upper_bounds</span><span class="p">)</span>

    <span class="c1"># Calculate the relative change for each solution and the bounds</span>
    <span class="n">relative_changes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">solution</span> <span class="o">-</span> <span class="n">initial_guess</span><span class="p">)</span> <span class="o">/</span> <span class="n">initial_guess</span> <span class="k">for</span> <span class="n">solution</span> <span class="ow">in</span> <span class="n">final_solutions</span><span class="p">]</span>
    <span class="n">relative_lower_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_bounds</span> <span class="o">-</span> <span class="n">initial_guess</span><span class="p">)</span> <span class="o">/</span> <span class="n">initial_guess</span>
    <span class="n">relative_upper_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">upper_bounds</span> <span class="o">-</span> <span class="n">initial_guess</span><span class="p">)</span> <span class="o">/</span> <span class="n">initial_guess</span>

    <span class="c1"># Default markers and colors if not provided</span>
    <span class="k">if</span> <span class="n">markers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_solutions</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">markersizes</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
        <span class="n">markersizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">markersizes</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">final_solutions</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;magma&#39;</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_solutions</span><span class="p">)))</span>  <span class="c1"># Use default color cycle</span>
    
    <span class="c1"># Create fig and ax if not provided</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">6.4</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">))</span>

    <span class="c1"># Set labels </span>
    <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Solution </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">final_solutions</span><span class="p">))]</span>

    <span class="c1"># Plotting the error bar for bounds as relative changes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">),</span> 
                <span class="p">(</span><span class="n">relative_upper_bounds</span> <span class="o">+</span> <span class="n">relative_lower_bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> 
                <span class="n">yerr</span><span class="o">=</span><span class="p">[(</span><span class="n">relative_upper_bounds</span> <span class="o">-</span> <span class="n">relative_lower_bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> 
                      <span class="p">(</span><span class="n">relative_upper_bounds</span> <span class="o">-</span> <span class="n">relative_lower_bounds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">capsize</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>

    <span class="c1"># Plot each final solution</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rel_change</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">relative_changes</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">),</span> <span class="n">rel_change</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersizes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># Adding labels and titles</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Relative change from initial guess&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_off</span><span class="p">()</span>

    <span class="c1"># Set custom tick labels if provided</span>
    <span class="k">if</span> <span class="n">variable_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">variable_names</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="plot_convergence_process">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_convergence_process">[docs]</a>
<span class="k">def</span> <span class="nf">plot_convergence_process</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">plot_together</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the convergence process for multiple optimization algorithms.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : dict</span>
<span class="sd">        A dictionary where each key is the algorithm name and the value is another dictionary</span>
<span class="sd">        with the following keys:</span>
<span class="sd">        - &#39;objective&#39; : list</span>
<span class="sd">            List of objective values at each iteration.</span>
<span class="sd">        - &#39;constraint_violation&#39; : list</span>
<span class="sd">            List of constraint violations at each iteration.</span>
<span class="sd">        - &#39;iterations&#39; : list</span>
<span class="sd">            List of iteration counts corresponding to the objective values and constraint violations.</span>
<span class="sd">        </span>
<span class="sd">    plot_together : bool, optional</span>
<span class="sd">        If True, plots the objective value and constraint violation in separate subplots in the same figure.</span>
<span class="sd">        If False, plots them in separate figures. Default is True.</span>
<span class="sd">        </span>
<span class="sd">    colors : list, optional</span>
<span class="sd">        List of colors for the lines, one for each algorithm. If None, default colors are used.</span>
<span class="sd">        </span>
<span class="sd">    linestyles : list, optional</span>
<span class="sd">        List of linestyles for the lines, one for each algorithm. If None, default linestyles are used.</span>
<span class="sd">        </span>
<span class="sd">    labels : list, optional</span>
<span class="sd">        List of labels for the legend, one for each algorithm. If None, the dictionary keys are used as labels.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    fig : matplotlib.figure.Figure</span>
<span class="sd">        The figure object containing the plots.</span>
<span class="sd">        </span>
<span class="sd">    ax : matplotlib.axes.Axes or list of Axes</span>
<span class="sd">        The axes object(s) containing the plots. If `plot_together=True`, a list of two axes is returned.</span>
<span class="sd">        Otherwise, a single axes object is returned.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function creates either one or two subplots depending on the `plot_together` parameter.</span>
<span class="sd">    It also customizes the plots using the provided colors, linestyles, and labels.</span>
<span class="sd">    </span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; data = {</span>
<span class="sd">    &gt;&gt;&gt;     &#39;Algorithm 1&#39;: {</span>
<span class="sd">    &gt;&gt;&gt;         &#39;objective&#39;: [10, 8, 6, 5, 3],</span>
<span class="sd">    &gt;&gt;&gt;         &#39;constraint_violation&#39;: [1, 0.8, 0.5, 0.3, 0],</span>
<span class="sd">    &gt;&gt;&gt;         &#39;iterations&#39;: [1, 2, 3, 4, 5],</span>
<span class="sd">    &gt;&gt;&gt;     },</span>
<span class="sd">    &gt;&gt;&gt;     &#39;Algorithm 2&#39;: {</span>
<span class="sd">    &gt;&gt;&gt;         &#39;objective&#39;: [12, 9, 7, 4, 2],</span>
<span class="sd">    &gt;&gt;&gt;         &#39;constraint_violation&#39;: [1.2, 0.7, 0.6, 0.2, 0.1],</span>
<span class="sd">    &gt;&gt;&gt;         &#39;iterations&#39;: [1, 2, 3, 4, 5],</span>
<span class="sd">    &gt;&gt;&gt;     }</span>
<span class="sd">    &gt;&gt;&gt; }</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plot_convergence_process(data, plot_together=True, colors=[&#39;blue&#39;, &#39;green&#39;], linestyles=[&#39;-&#39;, &#39;--&#39;], labels=[&#39;Algo 1&#39;, &#39;Algo 2&#39;])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">linestyles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">plot_together</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">figs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="p">]</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">figs</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig1</span><span class="p">,</span> <span class="n">fig2</span><span class="p">]</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iterations&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">algo_data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">iterations</span> <span class="o">=</span> <span class="n">algo_data</span><span class="p">[</span><span class="s1">&#39;iterations&#39;</span><span class="p">]</span>
        <span class="n">objective</span> <span class="o">=</span> <span class="n">algo_data</span><span class="p">[</span><span class="s1">&#39;objective&#39;</span><span class="p">]</span>
        <span class="n">constraint_violation</span> <span class="o">=</span> <span class="n">algo_data</span><span class="p">[</span><span class="s1">&#39;constraint_violation&#39;</span><span class="p">]</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">constraint_violation</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Objective value&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iterations&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Constraint violation&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">plot_together</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">figs</span><span class="p">,</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="NURBS">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.NURBS">[docs]</a>
<span class="k">def</span> <span class="nf">NURBS</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>

    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">dim</span><span class="p">,</span> <span class="n">nn</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># nn = n+1 control points</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span>      <span class="c1"># total B-spline segments for initial p=0</span>

    <span class="c1"># ** We now allocate with &#39;m&#39; columns instead of &#39;nn&#39;: **</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

    <span class="c1"># First step (p=0)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">N</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">u</span> <span class="o">&lt;=</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">current_p</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">N_bis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">denom1</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">current_p</span><span class="p">]</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">denom2</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">current_p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">denom1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="p">((</span><span class="n">u</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">denom1</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">if</span> <span class="n">denom2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="p">((</span><span class="n">U</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">current_p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom2</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
            <span class="n">N_bis</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span>

        <span class="n">N</span> <span class="o">=</span> <span class="n">N_bis</span>
        <span class="n">current_p</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># At this point, N has shape (Nt, n+1).</span>
    <span class="c1"># Compute rational basis</span>
    <span class="n">W_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="p">(</span><span class="n">Nt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="n">W_mat</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">denominator</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1e-14</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

    <span class="c1"># Evaluate final curve in R^dim</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">P</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># shape (Nt, dim)</span>

    <span class="k">return</span> <span class="n">r</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">N</span></div>




<div class="viewcode-block" id="plot_blade_profile">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_blade_profile">[docs]</a>
<span class="k">def</span> <span class="nf">plot_blade_profile</span><span class="p">(</span><span class="n">blade_parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Python version of the MATLAB function [x, y] = plot_blade_profile(blade_parameters).</span>

<span class="sd">    Given a dictionary `blade_parameters` with:</span>
<span class="sd">      chord, stagger, theta_in, theta_out,</span>
<span class="sd">      wedge_in, wedge_out, radius_in, radius_out,</span>
<span class="sd">      d1, d2, d3, d4</span>
<span class="sd">    it computes the shape of a 2D blade profile (x, y) by connecting</span>
<span class="sd">    four NURBS segments:</span>
<span class="sd">      (1) Leading edge arc (between points 1 and 2)</span>
<span class="sd">      (2) Spline from point 2 to point 3</span>
<span class="sd">      (3) Trailing edge arc (between points 3 and 4)</span>
<span class="sd">      (4) Spline from point 4 back to point 1</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    x, y : 1D numpy arrays</span>
<span class="sd">        The concatenated coordinates of the blade in the plane.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># -- 1) Unpack parameters --</span>
    <span class="n">chord</span>      <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;chord&quot;</span><span class="p">]</span>        <span class="c1"># Blade chord</span>
    <span class="n">stagger</span>    <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;stagger&quot;</span><span class="p">]</span>      <span class="c1"># Stagger angle</span>
    <span class="n">theta_in</span>   <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;theta_in&quot;</span><span class="p">]</span>     <span class="c1"># Inlet camber angle</span>
    <span class="n">theta_out</span>  <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;theta_out&quot;</span><span class="p">]</span>    <span class="c1"># Outlet camber angle</span>
    <span class="n">wedge_in</span>   <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;wedge_in&quot;</span><span class="p">]</span>     <span class="c1"># Leading edge wedge semiangle</span>
    <span class="n">wedge_out</span>  <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;wedge_out&quot;</span><span class="p">]</span>    <span class="c1"># Trailing edge wedge semiangle</span>
    <span class="n">radius_in</span>  <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;radius_in&quot;</span><span class="p">]</span>    <span class="c1"># Leading edge radius</span>
    <span class="n">radius_out</span> <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;radius_out&quot;</span><span class="p">]</span>   <span class="c1"># Trailing edge radius</span>
    <span class="n">d1</span>         <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;d1&quot;</span><span class="p">]</span>
    <span class="n">d2</span>         <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;d2&quot;</span><span class="p">]</span>
    <span class="n">d3</span>         <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;d3&quot;</span><span class="p">]</span>
    <span class="n">d4</span>         <span class="o">=</span> <span class="n">blade_parameters</span><span class="p">[</span><span class="s2">&quot;d4&quot;</span><span class="p">]</span>

    <span class="c1"># -- 2) Points 1, 2, 3, 4 (the &#39;corners&#39; of the blade) --</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">theta_in</span> <span class="o">+</span> <span class="n">wedge_in</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">radius_in</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a1</span><span class="p">))</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">radius_in</span><span class="o">*</span><span class="p">(</span>    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a1</span><span class="p">))</span>

    <span class="n">a2</span> <span class="o">=</span> <span class="n">theta_in</span> <span class="o">-</span> <span class="n">wedge_in</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">radius_in</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">radius_in</span><span class="o">*</span><span class="p">(</span>    <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a2</span><span class="p">))</span>

    <span class="n">a3</span> <span class="o">=</span> <span class="n">theta_out</span> <span class="o">+</span> <span class="n">wedge_out</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">chord</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">stagger</span><span class="p">)</span> <span class="o">-</span> <span class="n">radius_out</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a3</span><span class="p">))</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="n">chord</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">stagger</span><span class="p">)</span> <span class="o">-</span> <span class="n">radius_out</span><span class="o">*</span><span class="p">(</span>    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a3</span><span class="p">))</span>

    <span class="n">a4</span> <span class="o">=</span> <span class="n">theta_out</span> <span class="o">-</span> <span class="n">wedge_out</span>
    <span class="n">x4</span> <span class="o">=</span> <span class="n">chord</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">stagger</span><span class="p">)</span> <span class="o">-</span> <span class="n">radius_out</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a4</span><span class="p">))</span>
    <span class="n">y4</span> <span class="o">=</span> <span class="n">chord</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">stagger</span><span class="p">)</span> <span class="o">+</span> <span class="n">radius_out</span><span class="o">*</span><span class="p">(</span>    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a4</span><span class="p">))</span>

    <span class="c1"># ---------------------------</span>
    <span class="c1"># -- Segment 1: arc 1 -&gt; 2 --</span>
    <span class="c1"># ---------------------------</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>
    <span class="c1"># Normal direction</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">P2</span> <span class="o">-</span> <span class="n">P0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>  <span class="c1"># rotate 90 deg</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">a</span>  <span class="o">=</span> <span class="n">wedge_in</span>
    <span class="n">R</span>  <span class="o">=</span> <span class="n">radius_in</span>
    <span class="c1"># Middle control point</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="p">(</span><span class="n">P0</span> <span class="o">+</span> <span class="n">P2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">n</span>

    <span class="c1"># Combine into a matrix of shape (dim, n+1)</span>
    <span class="c1"># Here: P0, P1, P2 =&gt; 3 control points for a 2nd-order NURBS</span>
    <span class="n">ctrl_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">])</span>

    <span class="c1"># Weights</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># The second control point gets weight = sin(a)</span>
    <span class="n">W</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># Parameter vector</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Quadratic</span>
    <span class="c1"># Clamped knot vector: p+1 zeros, n-p equispaced, p+1 ones</span>
    <span class="c1"># n = 2 =&gt; number of segments = 2, so for a Bezier we do</span>
    <span class="c1"># U = [0,0, ..., 1,1], length = n+p+2 = 2+2+2=6</span>
    <span class="c1"># Typically for a quadratic Bezier: [0,0,0,1,1,1]</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">p</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">p</span><span class="p">)])</span>
    <span class="c1"># But strictly we want 3 control points =&gt; n=2 =&gt; n-p+2=2-2+2=2</span>
    <span class="c1"># so U = [0,0, 1,1, 1,1]? We&#39;ll mimic the exact MATLAB approach:</span>
    <span class="c1"># The MATLAB code does: U = [zeros(1,p), linspace(0,1,n-p+2), ones(1,p)]</span>
    <span class="c1"># For n=2, p=2 =&gt; n-p+2=2 =&gt; U = [0,0, 0..1, 1,1] =&gt; [0,0,0,1,1,1]</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Evaluate NURBS</span>
    <span class="n">r12</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">NURBS</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------</span>
    <span class="c1"># -- Segment 2: from point 2 -&gt; point 3 (cubic)  --</span>
    <span class="c1"># -------------------------------------------------</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">+</span> <span class="n">d2</span><span class="o">*</span><span class="n">chord</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a2</span><span class="p">)])</span>
    <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">])</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="n">P3</span> <span class="o">-</span> <span class="n">d3</span><span class="o">*</span><span class="n">chord</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a3</span><span class="p">)])</span>

    <span class="n">ctrl_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">])</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># cubic</span>
    <span class="c1"># For a cubic Bezier with 4 control points, we have n=3 =&gt; n-p+2=3-3+2=2</span>
    <span class="c1"># so the knot vector length is 4+3+1=8, typically [0,0,0,0,1,1,1,1]</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">r23</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">NURBS</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="c1"># -----------------------------</span>
    <span class="c1"># -- Segment 3: arc 3 -&gt; 4   --</span>
    <span class="c1"># -----------------------------</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">])</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">])</span>
    <span class="c1"># Normal direction</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">P2</span> <span class="o">-</span> <span class="n">P0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">a</span>  <span class="o">=</span> <span class="n">wedge_out</span>
    <span class="n">R</span>  <span class="o">=</span> <span class="n">radius_out</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="p">(</span><span class="n">P0</span> <span class="o">+</span> <span class="n">P2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">R</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">n</span>

    <span class="n">ctrl_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">])</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">W</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">r34</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">NURBS</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="c1"># ------------------------------------------------</span>
    <span class="c1"># -- Segment 4: from point 4 -&gt; point 1 (cubic) --</span>
    <span class="c1"># ------------------------------------------------</span>
    <span class="c1"># We re-use the same approach as segment 2 (cubic)</span>
    <span class="n">P0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="p">])</span>
    <span class="n">P1</span> <span class="o">=</span> <span class="n">P0</span> <span class="o">-</span> <span class="n">d1</span><span class="o">*</span><span class="n">chord</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a4</span><span class="p">)])</span>
    <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">])</span>
    <span class="n">P2</span> <span class="o">=</span> <span class="n">P3</span> <span class="o">+</span> <span class="n">d4</span><span class="o">*</span><span class="n">chord</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a1</span><span class="p">)])</span>

    <span class="n">ctrl_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">P0</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">P3</span><span class="p">])</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">r41</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">NURBS</span><span class="p">(</span><span class="n">ctrl_pts</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span>

    <span class="c1"># -- Combine segments --</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r12</span><span class="p">,</span> <span class="n">r23</span><span class="p">,</span> <span class="n">r34</span><span class="p">,</span> <span class="n">r41</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">r</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>



<div class="viewcode-block" id="plot_view_axial_tangential">
<a class="viewcode-back" href="../../source/api/turboflow.plot_functions.html#turboflow.plot_functions.plot_view_axial_tangential">[docs]</a>
<span class="k">def</span> <span class="nf">plot_view_axial_tangential</span><span class="p">(</span><span class="n">problem_structure</span><span class="p">,</span> 
                               <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                               <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                               <span class="n">repeats</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                               <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> 
                               <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> 
                               <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optional: Python version of the MATLAB function plot_view_axial_tangential.</span>
<span class="sd">    Demonstrates how a multi-stage turbine might be visualized in an axial-tangential view,</span>
<span class="sd">    using repeated calls to plot_blade_profile for rotor/stator rows.</span>

<span class="sd">    turbine_data is a dictionary expected to have structure:</span>
<span class="sd">       turbine_data[&#39;cascade&#39;] = list of dicts, each with</span>
<span class="sd">         {</span>
<span class="sd">           &#39;s&#39;: ...,         # pitch</span>
<span class="sd">           &#39;cs&#39;: ...,        # spacing between cascades</span>
<span class="sd">           &#39;c&#39;: ...,         # chord</span>
<span class="sd">           &#39;b&#39;: ...,         # axial spacing</span>
<span class="sd">           &#39;stagger&#39;: ...,</span>
<span class="sd">           &#39;theta_in&#39;: ...,</span>
<span class="sd">           &#39;theta_out&#39;: ...,</span>
<span class="sd">           &#39;t_max&#39;: ...,</span>
<span class="sd">           &#39;t_te&#39;: ...,</span>
<span class="sd">         }</span>
<span class="sd">       turbine_data[&#39;overall&#39;] = {</span>
<span class="sd">           &#39;axial_length&#39;: ...,</span>
<span class="sd">           &#39;n_stages&#39;: ...,</span>
<span class="sd">       }</span>
<span class="sd">       turbine_data[&#39;stage&#39;] = {</span>
<span class="sd">           &#39;R&#39;: [reaction_values],</span>
<span class="sd">       }</span>

<span class="sd">    This function is included mainly to show how one might replicate</span>
<span class="sd">    the high-level plotting. It references internal design logic</span>
<span class="sd">    that is specific to your original MATLAB code.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load data from problem structure</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">problem_structure</span><span class="o">.</span><span class="n">geometry</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">problem_structure</span><span class="o">.</span><span class="n">results</span>

    <span class="c1"># Extract data from turbine_data</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;axial_chord&#39;</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;chord&#39;</span><span class="p">]</span>
    <span class="n">stagger</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;stagger_angle&#39;</span><span class="p">]</span>
    <span class="n">theta_in</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;leading_edge_angle&#39;</span><span class="p">]</span>
    <span class="n">theta_out</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;gauging_angle&#39;</span><span class="p">]</span>
    <span class="n">t_max</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;maximum_thickness&#39;</span><span class="p">]</span>
    <span class="n">t_te</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;trailing_edge_thickness&#39;</span><span class="p">]</span>
    <span class="n">n_cascades</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s1">&#39;number_of_cascades&#39;</span><span class="p">]</span>
    <span class="n">reaction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">][</span><span class="s1">&#39;reaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>  <span class="c1"># one per stage</span>
    
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># Axial spacing between cascades relative to max axial chord</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dx</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_cascades</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Create figure</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">L</span><span class="o">*</span><span class="mf">1.1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Axial direction&quot;</span><span class="p">)</span>

    <span class="c1"># Now actually plot the blades</span>
    <span class="n">x_0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cascades</span><span class="p">):</span>
        <span class="c1"># Build a dictionary of blade parameters</span>
        <span class="k">if</span> <span class="n">reaction</span><span class="p">[</span><span class="n">j</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.25</span> <span class="ow">and</span> <span class="p">((</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1"># &quot;Impulse blade&quot; parameters for rotor</span>
            <span class="n">blade_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;chord&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                <span class="s1">&#39;stagger&#39;</span><span class="p">:</span> <span class="n">stagger</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;theta_in&#39;</span><span class="p">:</span> <span class="n">theta_in</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;theta_out&#39;</span><span class="p">:</span> <span class="n">theta_out</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;wedge_in&#39;</span><span class="p">:</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;wedge_out&#39;</span><span class="p">:</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;radius_in&#39;</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">t_te</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                <span class="s1">&#39;radius_out&#39;</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">t_te</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                <span class="s1">&#39;d1&#39;</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">,</span>
                <span class="s1">&#39;d2&#39;</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span>
                <span class="s1">&#39;d3&#39;</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span>
                <span class="s1">&#39;d4&#39;</span><span class="p">:</span> <span class="mf">0.60</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># &quot;Reaction blade&quot; parameters</span>
            <span class="n">blade_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;chord&#39;</span><span class="p">:</span> <span class="n">c</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                <span class="s1">&#39;stagger&#39;</span><span class="p">:</span> <span class="n">stagger</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;theta_in&#39;</span><span class="p">:</span> <span class="n">theta_in</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;theta_out&#39;</span><span class="p">:</span> <span class="n">theta_out</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;wedge_in&#39;</span><span class="p">:</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;wedge_out&#39;</span><span class="p">:</span> <span class="mf">7.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span>
                <span class="s1">&#39;radius_in&#39;</span><span class="p">:</span> <span class="mf">0.50</span> <span class="o">*</span> <span class="n">t_max</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                <span class="s1">&#39;radius_out&#39;</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">t_te</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                <span class="s1">&#39;d1&#39;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>
                <span class="s1">&#39;d2&#39;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>
                <span class="s1">&#39;d3&#39;</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>
                <span class="s1">&#39;d4&#39;</span><span class="p">:</span> <span class="mf">0.30</span>
            <span class="p">}</span>

        <span class="c1"># Get blade coordinates</span>
        <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">plot_blade_profile</span><span class="p">(</span><span class="n">blade_params</span><span class="p">)</span>

        <span class="c1"># Plot multiple blade passages in the tangential direction</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeats</span><span class="p">):</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">k</span>
            <span class="c1"># sign = 1</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bx</span> <span class="o">+</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">by</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span>  <span class="o">=</span> <span class="n">label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bx</span> <span class="o">+</span> <span class="n">x_0</span><span class="p">,</span> <span class="n">by</span> <span class="o">+</span> <span class="n">sign</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="n">linestyle</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Move x_0 to the next cascade</span>
        <span class="n">x_0</span> <span class="o">+=</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">cs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> </div>








</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Lasse Borg Anderson and Roberto Agromayor.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>